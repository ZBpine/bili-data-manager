// ==UserScript==
// @name        BiliDataManager
// @namespace   https://github.com/ZBpine/bili-data-manager
// @description BiliDataManager æ˜¯ä¸€ä¸ª Bilibili æ•°æ®ç®¡ç†å·¥å…·åº“ï¼Œæ—¨åœ¨ä¸ºå¼€å‘è€…æä¾›ç®€æ´çš„æŽ¥å£æ¥æŠ“å–å’Œå¤„ç† Bilibili çš„å„ç§æ•°æ®ã€‚
// @version     1.0.0
// @author      ZBpine
// @icon        https://www.bilibili.com/favicon.ico
// @license     MIT
// ==/UserScript==

!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.BiliDataManager=e():t.BiliDataManager=e()}(Object("undefined"!=typeof self?self:this),()=>(()=>{var __webpack_modules__={45(t){"use strict";t.exports=function(t,e){for(var i=new Array(arguments.length-1),r=0,o=2,n=!0;o<arguments.length;)i[r++]=arguments[o++];return new Promise(function(o,s){i[r]=function(t){if(n)if(n=!1,t)s(t);else{for(var e=new Array(arguments.length-1),i=0;i<e.length;)e[i++]=arguments[i];o.apply(null,e)}};try{t.apply(e||null,i)}catch(t){n&&(n=!1,s(t))}})}},47(t,e,i){"use strict";e.Service=i(595)},153(module){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}module.exports=inquire},158(t,e,i){"use strict";t.exports=n;var r=i(237);(n.prototype=Object.create(r.prototype)).constructor=n;var o=i(610);function n(t){r.call(this,t)}n._configure=function(){o.Buffer&&(n.prototype._slice=o.Buffer.prototype.slice)},n.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},n._configure()},237(t,e,i){"use strict";t.exports=l;var r,o=i(610),n=o.LongBits,s=o.utf8;function a(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function l(t){this.buf=t,this.pos=0,this.len=t.length}var c,u="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new l(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new l(t);throw Error("illegal buffer")},p=function(){return o.Buffer?function(t){return(l.create=function(t){return o.Buffer.isBuffer(t)?new r(t):u(t)})(t)}:u};function d(){var t=new n(0,0),e=0;if(!(this.len-this.pos>4)){for(;e<3;++e){if(this.pos>=this.len)throw a(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw a(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function m(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw a(this,8);return new n(m(this.buf,this.pos+=4),m(this.buf,this.pos+=4))}l.create=p(),l.prototype._slice=o.Array.prototype.subarray||o.Array.prototype.slice,l.prototype.uint32=(c=4294967295,function(){if(c=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return c;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return c}),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return m(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|m(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var t=o.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},l.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var t=o.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},l.prototype.bytes=function(){var t=this.uint32(),e=this.pos,i=this.pos+t;if(i>this.len)throw a(this,t);if(this.pos+=t,Array.isArray(this.buf))return this.buf.slice(e,i);if(e===i){var r=o.Buffer;return r?r.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,e,i)},l.prototype.string=function(){var t=this.bytes();return s.read(t,0,t.length)},l.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw a(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},l._configure=function(t){r=t,l.create=p(),r._configure();var e=o.Long?"toLong":"toNumber";o.merge(l.prototype,{int64:function(){return d.call(this)[e](!1)},uint64:function(){return d.call(this)[e](!0)},sint64:function(){return d.call(this).zzDecode()[e](!1)},fixed64:function(){return f.call(this)[e](!0)},sfixed64:function(){return f.call(this)[e](!1)}})}},239(t,e,i){"use strict";t.exports=o;var r=i(610);function o(t,e){this.lo=t>>>0,this.hi=e>>>0}var n=o.zero=new o(0,0);n.toNumber=function(){return 0},n.zzEncode=n.zzDecode=function(){return this},n.length=function(){return 1};var s=o.zeroHash="\0\0\0\0\0\0\0\0";o.fromNumber=function(t){if(0===t)return n;var e=t<0;e&&(t=-t);var i=t>>>0,r=(t-i)/4294967296>>>0;return e&&(r=~r>>>0,i=~i>>>0,++i>4294967295&&(i=0,++r>4294967295&&(r=0))),new o(i,r)},o.from=function(t){if("number"==typeof t)return o.fromNumber(t);if(r.isString(t)){if(!r.Long)return o.fromNumber(parseInt(t,10));t=r.Long.fromString(t)}return t.low||t.high?new o(t.low>>>0,t.high>>>0):n},o.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=1+~this.lo>>>0,i=~this.hi>>>0;return e||(i=i+1>>>0),-(e+4294967296*i)}return this.lo+4294967296*this.hi},o.prototype.toLong=function(t){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var a=String.prototype.charCodeAt;o.fromHash=function(t){return t===s?n:new o((a.call(t,0)|a.call(t,1)<<8|a.call(t,2)<<16|a.call(t,3)<<24)>>>0,(a.call(t,4)|a.call(t,5)<<8|a.call(t,6)<<16|a.call(t,7)<<24)>>>0)},o.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},o.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},o.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},o.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return 0===i?0===e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:i<128?9:10}},358(t){"use strict";function e(){this._listeners={}}t.exports=e,e.prototype.on=function(t,e,i){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:i||this}),this},e.prototype.off=function(t,e){if(void 0===t)this._listeners={};else if(void 0===e)this._listeners[t]=[];else for(var i=this._listeners[t],r=0;r<i.length;)i[r].fn===e?i.splice(r,1):++r;return this},e.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var i=[],r=1;r<arguments.length;)i.push(arguments[r++]);for(r=0;r<e.length;)e[r].fn.apply(e[r++].ctx,i)}return this}},390(t){"use strict";t.exports=function(t,e,i){var r=i||8192,o=r>>>1,n=null,s=r;return function(i){if(i<1||i>o)return t(i);s+i>r&&(n=t(r),s=0);var a=e.call(n,s,s+=i);return 7&s&&(s=1+(7|s)),a}}},394(t,e,i){"use strict";var r=e;function o(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=i(449),r.BufferWriter=i(818),r.Reader=i(237),r.BufferReader=i(158),r.util=i(610),r.rpc=i(47),r.roots=i(529),r.configure=o,o()},410(t){"use strict";function e(t){return"undefined"!=typeof Float32Array?function(){var e=new Float32Array([-0]),i=new Uint8Array(e.buffer),r=128===i[3];function o(t,r,o){e[0]=t,r[o]=i[0],r[o+1]=i[1],r[o+2]=i[2],r[o+3]=i[3]}function n(t,r,o){e[0]=t,r[o]=i[3],r[o+1]=i[2],r[o+2]=i[1],r[o+3]=i[0]}function s(t,r){return i[0]=t[r],i[1]=t[r+1],i[2]=t[r+2],i[3]=t[r+3],e[0]}function a(t,r){return i[3]=t[r],i[2]=t[r+1],i[1]=t[r+2],i[0]=t[r+3],e[0]}t.writeFloatLE=r?o:n,t.writeFloatBE=r?n:o,t.readFloatLE=r?s:a,t.readFloatBE=r?a:s}():function(){function e(t,e,i,r){var o=e<0?1:0;if(o&&(e=-e),0===e)t(1/e>0?0:2147483648,i,r);else if(isNaN(e))t(2143289344,i,r);else if(e>34028234663852886e22)t((o<<31|2139095040)>>>0,i,r);else if(e<11754943508222875e-54)t((o<<31|Math.round(e/1401298464324817e-60))>>>0,i,r);else{var n=Math.floor(Math.log(e)/Math.LN2);t((o<<31|n+127<<23|8388607&Math.round(e*Math.pow(2,-n)*8388608))>>>0,i,r)}}function s(t,e,i){var r=t(e,i),o=2*(r>>31)+1,n=r>>>23&255,s=8388607&r;return 255===n?s?NaN:o*(1/0):0===n?1401298464324817e-60*o*s:o*Math.pow(2,n-150)*(s+8388608)}t.writeFloatLE=e.bind(null,i),t.writeFloatBE=e.bind(null,r),t.readFloatLE=s.bind(null,o),t.readFloatBE=s.bind(null,n)}(),"undefined"!=typeof Float64Array?function(){var e=new Float64Array([-0]),i=new Uint8Array(e.buffer),r=128===i[7];function o(t,r,o){e[0]=t,r[o]=i[0],r[o+1]=i[1],r[o+2]=i[2],r[o+3]=i[3],r[o+4]=i[4],r[o+5]=i[5],r[o+6]=i[6],r[o+7]=i[7]}function n(t,r,o){e[0]=t,r[o]=i[7],r[o+1]=i[6],r[o+2]=i[5],r[o+3]=i[4],r[o+4]=i[3],r[o+5]=i[2],r[o+6]=i[1],r[o+7]=i[0]}function s(t,r){return i[0]=t[r],i[1]=t[r+1],i[2]=t[r+2],i[3]=t[r+3],i[4]=t[r+4],i[5]=t[r+5],i[6]=t[r+6],i[7]=t[r+7],e[0]}function a(t,r){return i[7]=t[r],i[6]=t[r+1],i[5]=t[r+2],i[4]=t[r+3],i[3]=t[r+4],i[2]=t[r+5],i[1]=t[r+6],i[0]=t[r+7],e[0]}t.writeDoubleLE=r?o:n,t.writeDoubleBE=r?n:o,t.readDoubleLE=r?s:a,t.readDoubleBE=r?a:s}():function(){function e(t,e,i,r,o,n){var s=r<0?1:0;if(s&&(r=-r),0===r)t(0,o,n+e),t(1/r>0?0:2147483648,o,n+i);else if(isNaN(r))t(0,o,n+e),t(2146959360,o,n+i);else if(r>17976931348623157e292)t(0,o,n+e),t((s<<31|2146435072)>>>0,o,n+i);else{var a;if(r<22250738585072014e-324)t((a=r/5e-324)>>>0,o,n+e),t((s<<31|a/4294967296)>>>0,o,n+i);else{var l=Math.floor(Math.log(r)/Math.LN2);1024===l&&(l=1023),t(4503599627370496*(a=r*Math.pow(2,-l))>>>0,o,n+e),t((s<<31|l+1023<<20|1048576*a&1048575)>>>0,o,n+i)}}}function s(t,e,i,r,o){var n=t(r,o+e),s=t(r,o+i),a=2*(s>>31)+1,l=s>>>20&2047,c=4294967296*(1048575&s)+n;return 2047===l?c?NaN:a*(1/0):0===l?5e-324*a*c:a*Math.pow(2,l-1075)*(c+4503599627370496)}t.writeDoubleLE=e.bind(null,i,0,4),t.writeDoubleBE=e.bind(null,r,4,0),t.readDoubleLE=s.bind(null,o,0,4),t.readDoubleBE=s.bind(null,n,4,0)}(),t}function i(t,e,i){e[i]=255&t,e[i+1]=t>>>8&255,e[i+2]=t>>>16&255,e[i+3]=t>>>24}function r(t,e,i){e[i]=t>>>24,e[i+1]=t>>>16&255,e[i+2]=t>>>8&255,e[i+3]=255&t}function o(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function n(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}t.exports=e(e)},447(t,e){"use strict";var i=e;i.length=function(t){for(var e=0,i=0,r=0;r<t.length;++r)(i=t.charCodeAt(r))<128?e+=1:i<2048?e+=2:55296==(64512&i)&&56320==(64512&t.charCodeAt(r+1))?(++r,e+=4):e+=3;return e},i.read=function(t,e,i){if(i-e<1)return"";for(var r,o=null,n=[],s=0;e<i;)(r=t[e++])<128?n[s++]=r:r>191&&r<224?n[s++]=(31&r)<<6|63&t[e++]:r>239&&r<365?(r=((7&r)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,n[s++]=55296+(r>>10),n[s++]=56320+(1023&r)):n[s++]=(15&r)<<12|(63&t[e++])<<6|63&t[e++],s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,n)),s=0);return o?(s&&o.push(String.fromCharCode.apply(String,n.slice(0,s))),o.join("")):String.fromCharCode.apply(String,n.slice(0,s))},i.write=function(t,e,i){for(var r,o,n=i,s=0;s<t.length;++s)(r=t.charCodeAt(s))<128?e[i++]=r:r<2048?(e[i++]=r>>6|192,e[i++]=63&r|128):55296==(64512&r)&&56320==(64512&(o=t.charCodeAt(s+1)))?(r=65536+((1023&r)<<10)+(1023&o),++s,e[i++]=r>>18|240,e[i++]=r>>12&63|128,e[i++]=r>>6&63|128,e[i++]=63&r|128):(e[i++]=r>>12|224,e[i++]=r>>6&63|128,e[i++]=63&r|128);return i-n}},449(t,e,i){"use strict";t.exports=p;var r,o=i(610),n=o.LongBits,s=o.base64,a=o.utf8;function l(t,e,i){this.fn=t,this.len=e,this.next=void 0,this.val=i}function c(){}function u(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function p(){this.len=0,this.head=new l(c,0,0),this.tail=this.head,this.states=null}var d=function(){return o.Buffer?function(){return(p.create=function(){return new r})()}:function(){return new p}};function m(t,e,i){e[i]=255&t}function f(t,e){this.len=t,this.next=void 0,this.val=e}function h(t,e,i){for(;t.hi;)e[i++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[i++]=127&t.lo|128,t.lo=t.lo>>>7;e[i++]=t.lo}function b(t,e,i){e[i]=255&t,e[i+1]=t>>>8&255,e[i+2]=t>>>16&255,e[i+3]=t>>>24}p.create=d(),p.alloc=function(t){return new o.Array(t)},o.Array!==Array&&(p.alloc=o.pool(p.alloc,o.Array.prototype.subarray)),p.prototype._push=function(t,e,i){return this.tail=this.tail.next=new l(t,e,i),this.len+=e,this},f.prototype=Object.create(l.prototype),f.prototype.fn=function(t,e,i){for(;t>127;)e[i++]=127&t|128,t>>>=7;e[i]=t},p.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new f((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},p.prototype.int32=function(t){return t<0?this._push(h,10,n.fromNumber(t)):this.uint32(t)},p.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},p.prototype.uint64=function(t){var e=n.from(t);return this._push(h,e.length(),e)},p.prototype.int64=p.prototype.uint64,p.prototype.sint64=function(t){var e=n.from(t).zzEncode();return this._push(h,e.length(),e)},p.prototype.bool=function(t){return this._push(m,1,t?1:0)},p.prototype.fixed32=function(t){return this._push(b,4,t>>>0)},p.prototype.sfixed32=p.prototype.fixed32,p.prototype.fixed64=function(t){var e=n.from(t);return this._push(b,4,e.lo)._push(b,4,e.hi)},p.prototype.sfixed64=p.prototype.fixed64,p.prototype.float=function(t){return this._push(o.float.writeFloatLE,4,t)},p.prototype.double=function(t){return this._push(o.float.writeDoubleLE,8,t)};var y=o.Array.prototype.set?function(t,e,i){e.set(t,i)}:function(t,e,i){for(var r=0;r<t.length;++r)e[i+r]=t[r]};p.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(m,1,0);if(o.isString(t)){var i=p.alloc(e=s.length(t));s.decode(t,i,0),t=i}return this.uint32(e)._push(y,e,t)},p.prototype.string=function(t){var e=a.length(t);return e?this.uint32(e)._push(a.write,e,t):this._push(m,1,0)},p.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new l(c,0,0),this.len=0,this},p.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(c,0,0),this.len=0),this},p.prototype.ldelim=function(){var t=this.head,e=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=t.next,this.tail=e,this.len+=i),this},p.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),i=0;t;)t.fn(t.val,e,i),i+=t.len,t=t.next;return e},p._configure=function(t){r=t,p.create=d(),r._configure()}},529(t){"use strict";t.exports={}},595(t,e,i){"use strict";t.exports=o;var r=i(610);function o(t,e,i){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(i)}(o.prototype=Object.create(r.EventEmitter.prototype)).constructor=o,o.prototype.rpcCall=function t(e,i,o,n,s){if(!n)throw TypeError("request must be specified");var a=this;if(!s)return r.asPromise(t,a,e,i,o,n);if(a.rpcImpl)try{return a.rpcImpl(e,i[a.requestDelimited?"encodeDelimited":"encode"](n).finish(),function(t,i){if(t)return a.emit("error",t,e),s(t);if(null!==i){if(!(i instanceof o))try{i=o[a.responseDelimited?"decodeDelimited":"decode"](i)}catch(t){return a.emit("error",t,e),s(t)}return a.emit("data",i,e),s(null,i)}a.end(!0)})}catch(t){return a.emit("error",t,e),void setTimeout(function(){s(t)},0)}else setTimeout(function(){s(Error("already ended"))},0)},o.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},610(t,e,i){"use strict";var r=e;function o(t,e,i){for(var r=Object.keys(e),o=0;o<r.length;++o)void 0!==t[r[o]]&&i||(t[r[o]]=e[r[o]]);return t}function n(t){function e(t,i){if(!(this instanceof e))return new e(t,i);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),i&&o(this,i)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return t},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}r.asPromise=i(45),r.base64=i(839),r.EventEmitter=i(358),r.float=i(410),r.inquire=i(153),r.utf8=i(447),r.pool=i(390),r.LongBits=i(239),r.isNode=Boolean(void 0!==i.g&&i.g&&i.g.process&&i.g.process.versions&&i.g.process.versions.node),r.global=r.isNode&&i.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},r.isString=function(t){return"string"==typeof t||t instanceof String},r.isObject=function(t){return t&&"object"==typeof t},r.isset=r.isSet=function(t,e){var i=t[e];return!(null==i||!t.hasOwnProperty(e))&&("object"!=typeof i||(Array.isArray(i)?i.length:Object.keys(i).length)>0)},r.Buffer=function(){try{var t=r.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(t){return"number"==typeof t?r.Buffer?r._Buffer_allocUnsafe(t):new r.Array(t):r.Buffer?r._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(t){return t?r.LongBits.from(t).toHash():r.LongBits.zeroHash},r.longFromHash=function(t,e){var i=r.LongBits.fromHash(t);return r.Long?r.Long.fromBits(i.lo,i.hi,e):i.toNumber(Boolean(e))},r.merge=o,r.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},r.newError=n,r.ProtocolError=n("ProtocolError"),r.oneOfGetter=function(t){for(var e={},i=0;i<t.length;++i)e[t[i]]=1;return function(){for(var t=Object.keys(this),i=t.length-1;i>-1;--i)if(1===e[t[i]]&&void 0!==this[t[i]]&&null!==this[t[i]])return t[i]}},r.oneOfSetter=function(t){return function(e){for(var i=0;i<t.length;++i)t[i]!==e&&delete this[t[i]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var t=r.Buffer;t?(r._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,i){return new t(e,i)},r._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},818(t,e,i){"use strict";t.exports=n;var r=i(449);(n.prototype=Object.create(r.prototype)).constructor=n;var o=i(610);function n(){r.call(this)}function s(t,e,i){t.length<40?o.utf8.write(t,e,i):e.utf8Write?e.utf8Write(t,i):e.write(t,i)}n._configure=function(){n.alloc=o._Buffer_allocUnsafe,n.writeBytesBuffer=o.Buffer&&o.Buffer.prototype instanceof Uint8Array&&"set"===o.Buffer.prototype.set.name?function(t,e,i){e.set(t,i)}:function(t,e,i){if(t.copy)t.copy(e,i,0,t.length);else for(var r=0;r<t.length;)e[i++]=t[r++]}},n.prototype.bytes=function(t){o.isString(t)&&(t=o._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(n.writeBytesBuffer,e,t),this},n.prototype.string=function(t){var e=o.Buffer.byteLength(t);return this.uint32(e),e&&this._push(s,e,t),this},n._configure()},839(t,e){"use strict";var i=e;i.length=function(t){var e=t.length;if(!e)return 0;for(var i=0;--e%4>1&&"="===t.charAt(e);)++i;return Math.ceil(3*t.length)/4-i};for(var r=new Array(64),o=new Array(123),n=0;n<64;)o[r[n]=n<26?n+65:n<52?n+71:n<62?n-4:n-59|43]=n++;i.encode=function(t,e,i){for(var o,n=null,s=[],a=0,l=0;e<i;){var c=t[e++];switch(l){case 0:s[a++]=r[c>>2],o=(3&c)<<4,l=1;break;case 1:s[a++]=r[o|c>>4],o=(15&c)<<2,l=2;break;case 2:s[a++]=r[o|c>>6],s[a++]=r[63&c],l=0}a>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,s)),a=0)}return l&&(s[a++]=r[o],s[a++]=61,1===l&&(s[a++]=61)),n?(a&&n.push(String.fromCharCode.apply(String,s.slice(0,a))),n.join("")):String.fromCharCode.apply(String,s.slice(0,a))};var s="invalid encoding";i.decode=function(t,e,i){for(var r,n=i,a=0,l=0;l<t.length;){var c=t.charCodeAt(l++);if(61===c&&a>1)break;if(void 0===(c=o[c]))throw Error(s);switch(a){case 0:r=c,a=1;break;case 1:e[i++]=r<<2|(48&c)>>4,r=c,a=2;break;case 2:e[i++]=(15&r)<<4|(60&c)>>2,r=c,a=3;break;case 3:e[i++]=(3&r)<<6|c,a=0}}if(1===a)throw Error(s);return i-n},i.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}},922(t,e,i){var r;!function(){"use strict";function o(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function n(t,e,i,r,n,s){return o((a=o(o(e,t),o(r,s)))<<(l=n)|a>>>32-l,i);var a,l}function s(t,e,i,r,o,s,a){return n(e&i|~e&r,t,e,o,s,a)}function a(t,e,i,r,o,s,a){return n(e&r|i&~r,t,e,o,s,a)}function l(t,e,i,r,o,s,a){return n(e^i^r,t,e,o,s,a)}function c(t,e,i,r,o,s,a){return n(i^(e|~r),t,e,o,s,a)}function u(t,e){var i,r,n,u,p;t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;var d=1732584193,m=-271733879,f=-1732584194,h=271733878;for(i=0;i<t.length;i+=16)r=d,n=m,u=f,p=h,d=s(d,m,f,h,t[i],7,-680876936),h=s(h,d,m,f,t[i+1],12,-389564586),f=s(f,h,d,m,t[i+2],17,606105819),m=s(m,f,h,d,t[i+3],22,-1044525330),d=s(d,m,f,h,t[i+4],7,-176418897),h=s(h,d,m,f,t[i+5],12,1200080426),f=s(f,h,d,m,t[i+6],17,-1473231341),m=s(m,f,h,d,t[i+7],22,-45705983),d=s(d,m,f,h,t[i+8],7,1770035416),h=s(h,d,m,f,t[i+9],12,-1958414417),f=s(f,h,d,m,t[i+10],17,-42063),m=s(m,f,h,d,t[i+11],22,-1990404162),d=s(d,m,f,h,t[i+12],7,1804603682),h=s(h,d,m,f,t[i+13],12,-40341101),f=s(f,h,d,m,t[i+14],17,-1502002290),d=a(d,m=s(m,f,h,d,t[i+15],22,1236535329),f,h,t[i+1],5,-165796510),h=a(h,d,m,f,t[i+6],9,-1069501632),f=a(f,h,d,m,t[i+11],14,643717713),m=a(m,f,h,d,t[i],20,-373897302),d=a(d,m,f,h,t[i+5],5,-701558691),h=a(h,d,m,f,t[i+10],9,38016083),f=a(f,h,d,m,t[i+15],14,-660478335),m=a(m,f,h,d,t[i+4],20,-405537848),d=a(d,m,f,h,t[i+9],5,568446438),h=a(h,d,m,f,t[i+14],9,-1019803690),f=a(f,h,d,m,t[i+3],14,-187363961),m=a(m,f,h,d,t[i+8],20,1163531501),d=a(d,m,f,h,t[i+13],5,-1444681467),h=a(h,d,m,f,t[i+2],9,-51403784),f=a(f,h,d,m,t[i+7],14,1735328473),d=l(d,m=a(m,f,h,d,t[i+12],20,-1926607734),f,h,t[i+5],4,-378558),h=l(h,d,m,f,t[i+8],11,-2022574463),f=l(f,h,d,m,t[i+11],16,1839030562),m=l(m,f,h,d,t[i+14],23,-35309556),d=l(d,m,f,h,t[i+1],4,-1530992060),h=l(h,d,m,f,t[i+4],11,1272893353),f=l(f,h,d,m,t[i+7],16,-155497632),m=l(m,f,h,d,t[i+10],23,-1094730640),d=l(d,m,f,h,t[i+13],4,681279174),h=l(h,d,m,f,t[i],11,-358537222),f=l(f,h,d,m,t[i+3],16,-722521979),m=l(m,f,h,d,t[i+6],23,76029189),d=l(d,m,f,h,t[i+9],4,-640364487),h=l(h,d,m,f,t[i+12],11,-421815835),f=l(f,h,d,m,t[i+15],16,530742520),d=c(d,m=l(m,f,h,d,t[i+2],23,-995338651),f,h,t[i],6,-198630844),h=c(h,d,m,f,t[i+7],10,1126891415),f=c(f,h,d,m,t[i+14],15,-1416354905),m=c(m,f,h,d,t[i+5],21,-57434055),d=c(d,m,f,h,t[i+12],6,1700485571),h=c(h,d,m,f,t[i+3],10,-1894986606),f=c(f,h,d,m,t[i+10],15,-1051523),m=c(m,f,h,d,t[i+1],21,-2054922799),d=c(d,m,f,h,t[i+8],6,1873313359),h=c(h,d,m,f,t[i+15],10,-30611744),f=c(f,h,d,m,t[i+6],15,-1560198380),m=c(m,f,h,d,t[i+13],21,1309151649),d=c(d,m,f,h,t[i+4],6,-145523070),h=c(h,d,m,f,t[i+11],10,-1120210379),f=c(f,h,d,m,t[i+2],15,718787259),m=c(m,f,h,d,t[i+9],21,-343485551),d=o(d,r),m=o(m,n),f=o(f,u),h=o(h,p);return[d,m,f,h]}function p(t){var e,i="",r=32*t.length;for(e=0;e<r;e+=8)i+=String.fromCharCode(t[e>>5]>>>e%32&255);return i}function d(t){var e,i=[];for(i[(t.length>>2)-1]=void 0,e=0;e<i.length;e+=1)i[e]=0;var r=8*t.length;for(e=0;e<r;e+=8)i[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return i}function m(t){var e,i,r="0123456789abcdef",o="";for(i=0;i<t.length;i+=1)e=t.charCodeAt(i),o+=r.charAt(e>>>4&15)+r.charAt(15&e);return o}function f(t){return unescape(encodeURIComponent(t))}function h(t){return function(t){return p(u(d(t),8*t.length))}(f(t))}function b(t,e){return function(t,e){var i,r,o=d(t),n=[],s=[];for(n[15]=s[15]=void 0,o.length>16&&(o=u(o,8*t.length)),i=0;i<16;i+=1)n[i]=909522486^o[i],s[i]=1549556828^o[i];return r=u(n.concat(d(e)),512+8*e.length),p(u(s.concat(r),640))}(f(t),f(e))}function y(t,e,i){return e?i?b(e,t):m(b(e,t)):i?h(t):m(h(t))}void 0===(r=function(){return y}.call(e,i,e,t))||(t.exports=r)}()},946(t,e,i){"use strict";t.exports=i(394)}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var i=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t].call(i.exports,i,i.exports,__webpack_require__),i.exports}__webpack_require__.d=(t,e)=>{for(var i in e)__webpack_require__.o(e,i)&&!__webpack_require__.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{BiliArchive:()=>l,BiliClient:()=>e,BiliComment:()=>g,BiliDanmaku:()=>h,create:()=>v,handler:()=>a});const t=__webpack_require__(922);class e{constructor(t,e){this.headers={"User-Agent":navigator.userAgent,Referer:"https://www.bilibili.com/"},this.wbiKey="",this.buvid3="",this.httpRequest=t,this.logger=e||new Proxy({},{get:()=>()=>{}})}getMixinKey(t){return[46,47,18,2,53,8,23,32,15,50,10,31,58,3,45,35,27,43,5,49,33,9,42,19,29,28,14,39,12,38,41,13,37,48,7,16,24,55,40,61,26,17,0,1,60,51,30,4,22,25,54,21,56,59,6,63,57,62,11,36,20,34,44,52].map(e=>t[e]).join("").slice(0,32)}async ensureWbiKey(){const t=Math.floor(Date.now()/36e5);if(!this.wbiKey||this.wbiKeyUpdateHour!==t)return this.wbiKeyPromise||(this.wbiKeyPromise=(async()=>{try{this.wbiKeyUpdateHour=Math.floor(Date.now()/36e5);const e=await this.request({url:"https://api.bilibili.com/x/web-interface/nav",desc:"èŽ·å–WBI key",sign:!1}),i=e?.data?.wbi_img?.img_url,r=e?.data?.wbi_img?.sub_url;if(!i||!r)throw new Error("èŽ·å– WBI å¤±è´¥");const o=i.slice(i.lastIndexOf("/")+1,i.lastIndexOf(".")),n=r.slice(r.lastIndexOf("/")+1,r.lastIndexOf("."));this.wbiKey=this.getMixinKey(o+n),this.wbiKeyUpdateHour=t}catch(t){this.logger.error("âŒ æ›´æ–° WBI Key å¤±è´¥",t)}finally{this.wbiKeyPromise=null}})()),this.wbiKeyPromise}getQuery(e={},i=!1){if(i&&this.wbiKey){e.wts=Math.round(Date.now()/1e3);const i=Object.keys(e).sort().map(t=>{const i=String(e[t]).replace(/[!'()*]/g,"");return`${encodeURIComponent(t)}=${encodeURIComponent(i)}`}).join("&");return i+"&w_rid="+t(i+this.wbiKey)}return Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&")}async ensureBuvid3(){return this.buvidPromise||(this.buvidPromise=new Promise((t,e)=>{this.httpRequest({method:"GET",url:"https://api.bilibili.com/x/web-frontend/getbuvid",onload:i=>{try{const r=JSON.parse(i.responseText),o=r?.data?.buvid;o?(this.buvid3=o,t(this.buvid3)):e({message:"æœªæˆåŠŸèŽ·å–åˆ° buvid3",response:r})}catch(t){e(t)}},onerror:e})}).finally(()=>{this.buvidPromise=null})),this.buvidPromise}async request({url:t,params:e={},responseType:i="json",sign:r=!1,desc:o=""}){r&&await this.ensureWbiKey();const n=this.getQuery(e,r),s=n?`${t}?${n}`:t,a=()=>new Promise((t,e)=>{const r={...this.headers};this.buvid3&&(r.Cookie=`buvid3=${this.buvid3}`),this.httpRequest({method:"GET",url:s,headers:r,responseType:i,onload:i=>{if(412==i.status)return e({code:412,message:"è¯·æ±‚è¢«æ‹¦æˆª",desc:o,res:i});this.logger.log(`ðŸŒ [${o}]`,i),t(i.response??i.responseText)},onerror:t=>{this.logger.error(`âŒ [${o}] ç½‘ç»œé”™è¯¯`,t),e(t)}})});return a().catch(async t=>{if(412===t.code&&!this.buvid3)return this.logger.warn(`âš ï¸ [${o}] è¯·æ±‚è¢«æ‹¦æˆªï¼Œå°è¯•åˆ·æ–° buvid3 é‡è¯•`),await this.ensureBuvid3(),a();throw t})}}function i(t){return"string"==typeof t?t.replace(/^http:/,"https:"):t}function r(t,e=0,i=0,r=0){if(!t)return null;const o=t=>t.toString().padStart(2,"0"),n=Date.parse(`${t}T${o(e)}:${o(i)}:${o(r)}+08:00`);return isNaN(n)?null:Math.floor(n/1e3)}function o(t){const e=new Date(1e3*t),i=t=>t.toString().padStart(2,"0");return`${e.getFullYear()}-${i(e.getMonth()+1)}-${i(e.getDate())}`}async function n({base:t=0,jitter:e=0,beforeFn:i=()=>{},afterFn:r=()=>{}}={}){if(t<=0||e<=0)return 0;const o=(n=t,s=t+e,Math.floor(Math.random()*(s-n+1))+n);var n,s;return i(o),await new Promise(t=>setTimeout(t,o)),r(o),o}const s=[{name:"video",keys:["video_view"],match:t=>/BV[a-zA-Z0-9]+/.test(t),parse(t){const e={},i=(t.match(/BV[a-zA-Z0-9]+/)||[])[0];if(!i)throw new Error("Video parse: no bvid");e.bvid=i,e.id="video/"+i;const r=t.match(/[?&]p=(\d+)/);if(r){const t=parseInt(r[1],10);!isNaN(t)&&t>=1&&(e.p=t,e.id=`video/${i}?p=${t}`)}return e.url="https://www.bilibili.com/"+e.id,e},async fetch(t,e){const{bvid:i}=e;if(!i)throw new Error("Video fetch: no bvid");const r=(await t.client.request({url:"https://api.bilibili.com/x/web-interface/view",params:{bvid:i},desc:`èŽ·å–è§†é¢‘ä¿¡æ¯ ${i}`})).data||{};return{...e,video_view:r}},extract(t){const e={},r=t?.video_view;if(r){const o=r.bvid||t.bvid;Object.assign(e,{id:`video/${o}`,aid:r.aid,cid:r.cid,oid:r.aid,bvid:o,type:1,duration:r.duration,title:r.title,desc:r.desc,cover:r.pic,pubtime:r.pubdate,owner:{mid:r.owner?.mid,name:r.owner?.name,face:r.owner?.face},stat:{view:r.stat?.view,like:r.stat?.like,coin:r.stat?.coin,favorite:r.stat?.favorite,share:r.stat?.share,danmaku:r.stat?.danmaku,reply:r.stat?.reply}}),r.staff&&(e.staff=[],r.staff.forEach(t=>{e.staff.push({mid:t.mid,name:t.name,face:t.face,role:t.title})}));const n=r.pages;if(Array.isArray(n)){let i=t.p?t.p-1:0;const r=n[i];i>0&&(e.id=`video/${o}?p=${i+1}`),n.length>1&&(e.subtitle=`ç¬¬ ${i+1} Pï¼š${r?.part||""}`),r&&(e.cid=r.cid??e.cid,e.duration=r.duration??e.duration)}e.cover=i(e.cover),e.owner.face=i(e.owner.face),e.url="https://www.bilibili.com/"+e.id}return e},getCustomConfig(t,e){const{aid:i,bvid:r}=e;if(!r)throw new Error("no bvid");const o={bvid:r};return i&&(o.aid=i),t.client.request({url:"https://api.bilibili.com/x/web-interface/archive/custom/config",params:o,desc:`èŽ·å–ç¨¿ä»¶è‡ªå®šä¹‰é…ç½® ${r}`})}},{name:"bangumi",keys:["bangumi_season_view","bangumi_episode_info"],match:t=>/(ep|ss)\d+/.test(t)&&!/cheese/i.test(t),parse(t){const e=t.match(/(ep|ss)(\d+)/i);if(!e)throw new Error("Bangumi parse: no ep/ss");const i=e[1].toLowerCase(),r=parseInt(e[2],10),o="ss"===i?"season_id":"ep_id";return{[o]:r,id:`bangumi/play/${i}${r}`,url:`https://www.bilibili.com/bangumi/play/${i}${r}`}},async fetch(t,e){let{ep_id:i,season_id:r}=e;if(!i&&!r)throw new Error("Bangumi fetch: no ep_id or season_id");const o=i?{ep_id:i}:{season_id:r},n=(await t.client.request({url:"https://api.bilibili.com/pgc/view/web/season",params:o,desc:"èŽ·å–å‰§é›†æ˜Žç»† "+(i?"ep"+i:"ss"+r)})).result||{};if(i||n?.user_status?.progress?.last_ep_id&&(i=n.user_status.progress.last_ep_id,e.ep_id=i),i){const r=(await t.client.request({url:"https://api.bilibili.com/pgc/season/episode/web/info",params:{ep_id:i},desc:`èŽ·å–å‰§é›†ä¿¡æ¯ ${i}`})).data||{};return{...e,bangumi_season_view:n,bangumi_episode_info:r}}return{...e,bangumi_season_view:n}},extract(t){const e={},r=t?.bangumi_season_view;if(r){const o=r.season_id||t.season_id;Object.assign(e,{id:`bangumi/play/ss${o}`,season_id:o,type:1,title:r.season_title,desc:r.evaluate,cover:r.cover,pubtime:Math.floor(Date.parse(r.publish?.pub_time)/1e3),owner:{mid:r.up_info?.mid,name:r.up_info?.uname,face:r.up_info?.avatar},stat:{view:r.stat?.views,like:r.stat?.likes,coin:r.stat?.coins,favorite:r.stat?.favorites,share:r.stat?.share,danmaku:r.stat?.danmakus,reply:r.stat?.reply}});const n=t.bangumi_episode_info?.episode_id||t.ep_id;if(n){let i=null,o=null;if(Array.isArray(r.episodes)&&(i=r.episodes.find(t=>t.ep_id===n||t.id===n),i&&(o="æ­£ç‰‡")),!i&&Array.isArray(r.section))for(const t of r.section)if(i=t.episodes?.find(t=>t.ep_id===n||t.id===n),i){o=t.title;break}if(!i)throw new Error("Bangumi extract: ep not found");Object.assign(e,{id:`bangumi/play/ep${n}`,ep_id:n,aid:i.aid,cid:i.cid,oid:i.aid,bvid:i.bvid,duration:Math.floor(i.duration/1e3),subtitle:`${o}ï¼š${i.show_title}`,cover:i.cover,pubtime:i.pub_time});const s=t.bangumi_episode_info;s&&(Object.assign(e,{owner:{mid:s.related_up?.[0]?.mid,name:s.related_up?.[0]?.uname,face:s.related_up?.[0]?.avatar},stat:{view:s.stat.view,like:s.stat.like,coin:s.stat.coin,favorite:s.stat.favorite,share:s.stat.share,danmaku:s.stat.dm,comment:s.stat.reply}}),s.related_up?.length>1&&(e.staff=[],s.related_up.forEach(t=>{e.staff.push({mid:t.mid,name:t.uname,face:t.avatar})})))}e.cover=i(e.cover),e.owner.face=i(e.owner.face),e.url="https://www.bilibili.com/"+e.id}return e}},{name:"dynamic",keys:["dynamic_detail"],match:t=>!/BV[a-zA-Z0-9]+/.test(t)&&!/(ep|ss)\d+/i.test(t)&&/(^|[^A-Za-z])\d+\b/.test(t),parse(t){const e=t.match(/(^|[^A-Za-z])(\d+)\b/);if(!e)throw new Error("Dynamic parse: no dynamic_id");const i=e[2];return{dynamic_id:i,id:i,url:`https://t.bilibili.com/${i}`}},async fetch(t,e){const{dynamic_id:i}=e;if(!i)throw new Error("Dynamic fetch: no dynamic_id");const r=(await t.client.request({url:"https://api.bilibili.com/x/polymer/web-dynamic/v1/detail",params:{id:i},desc:`èŽ·å–åŠ¨æ€ ${i} è¯¦æƒ…`})).data||{};return{...e,dynamic_detail:r}},extract(t){const e={},r=t?.dynamic_detail?.item;if(r){const{comment_type:t,comment_id_str:o,rid_str:n}=r.basic||{};if(!t||!o)throw new Error("Dynamic extract: missing comment_type or comment_id_str");Object.assign(e,{id:r.id_str,oid:o,type:t,dynamic_type:r.type}),n&&(e.rid=n);const{modules:s}=r;s&&(Object.assign(e,{pubtime:s.module_author?.pub_ts,owner:{mid:s.module_author?.mid,name:s.module_author?.name,face:s.module_author?.face},stat:{like:s.module_stat?.like?.count,share:s.module_stat?.forward?.count,reply:s.module_stat?.comment?.count}}),e.owner.face=i(e.owner.face)),e.url="https://t.bilibili.com/"+e.id}return e}},{name:"cheese",keys:["cheese_season_view"],match:t=>/(ep|ss)\d+/.test(t)&&!/bangumi/i.test(t),parse(t){const e=t.match(/(ep|ss)(\d+)/i);if(!e)throw new Error("Cheese parse: no ep/ss");const i=e[1].toLowerCase(),r=parseInt(e[2],10),o="ss"===i?"season_id":"ep_id";return{[o]:r,id:`cheese/play/${i}${r}`,url:`https://www.bilibili.com/cheese/play/${i}${r}`}},async fetch(t,e){let{ep_id:i,season_id:r}=e;if(!i&&!r)throw new Error("Cheese fetch: no ep_id or season_id");const o=i?{ep_id:i}:{season_id:r},n=(await t.client.request({url:"https://api.bilibili.com/pugv/view/web/season/v2",params:o,desc:"èŽ·å–è¯¾ç¨‹æ˜Žç»† "+(i?"ep"+i:"ss"+r)})).data||{};return i||n?.user_status?.progress?.last_ep_id&&(i=n.user_status.progress.last_ep_id,e.ep_id=i),{...e,cheese_season_view:n}},extract(t){const e={},r=t?.cheese_season_view;if(r){const o=r.season_id||t.season_id;Object.assign(e,{id:`cheese/play/ss${o}`,season_id:o,type:33,title:r.title,desc:r.subtitle,cover:r.cover,owner:{mid:r.up_info?.mid,name:r.up_info?.uname,face:r.up_info?.avatar},stat:{view:r.stat?.play,favorite:r.stat?.fav,share:r.stat?.share}}),r.cooperators?.length>0&&(e.staff=[],r.cooperators.forEach(t=>{e.staff.push({mid:t.mid,name:t.nick_name,face:t.avatar,role:t.role})}));const n=t.ep_id;if(n){let t=null,i=null;if(Array.isArray(r.sections))for(const e of r.sections)if(t=e.episodes?.find(t=>t.id===n),t){i=e.title;break}if(!t)throw new Error("Cheese extract: ep not found");Object.assign(e,{id:`cheese/play/ep${n}`,ep_id:n,aid:t.aid,cid:t.cid,oid:t.id,duration:t.duration,subtitle:`${i}ï¼š${t.title}`,cover:t.cover,pubtime:t.release_date}),Object.assign(e.stat,{view:t.play})}e.cover=i(e.cover),e.owner.face=i(e.owner.face),e.url="https://www.bilibili.com/"+e.id}return e}}],a={};for(const t of s)a[t.name]=t;class l{constructor(t,e){this.ctx=t,this.logger=t.logger||new Proxy({},{get:()=>()=>{}}),this.handlers=[],e=Array.isArray(e)?e:e?[e]:s;for(const t of e)"string"==typeof t&&a[t]&&(t=a[t]),t&&t.name&&this.handlers.push(t);this.info={},this.data={},this._handler=null}static parseUrl(t,e){const i=(e=e||[]).find(e=>e.match(t));return i?i.parse(t):{}}_pickHandler(t){let e=null;if("object"==typeof t&&null!==t&&(e=this.handlers.find(e=>e.keys&&Array.isArray(e.keys)&&e.keys.some(e=>Object.prototype.hasOwnProperty.call(t,e)))),!e){const i="string"==typeof t?t:t?.url;i&&(e=this.handlers.find(t=>t.match(i)))}if(!e)throw new Error("No handler matched");this._handler=e}clearData(){this.info={},this.data={},this._handler=null}async getData(t){try{this.clearData(),this._pickHandler(t);const e=this._handler.parse(t);this.data={...e};const i=await this._handler.fetch(this.ctx,e);return this.data.fetchtime=Math.floor(Date.now()/1e3),Object.assign(this.data,i),this.info=this._handler.extract(this.data),this.info.fetchtime=this.data.fetchtime,this.info}catch(t){return this.logger.error("BiliArchive getData error:",t),null}}setData(t){try{return this.clearData(),this._pickHandler(t),Object.assign(this.data,t),this.info=this._handler.extract(this.data),this.info.fetchtime=this.data.fetchtime??0,this.info}catch(t){return this.logger.error("BiliArchive setData error:",t),null}}}var c=__webpack_require__(946);const u=c.Reader,p=c.util,d=c.roots.default||(c.roots.default={}),m=(d.bilibili=(()=>{const t={};return t.community=function(){const t={};return t.service=function(){const t={};return t.dm=function(){const t={};return t.v1=function(){const t={};return t.DmSegMobileReply=function(){function t(t){if(this.elems=[],this.colorfulSrc=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.elems=p.emptyArray,t.prototype.state=0,t.prototype.aiFlag=null,t.prototype.colorfulSrc=p.emptyArray,t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.DmSegMobileReply;t.pos<r;){var n=t.uint32();if(n===i)break;switch(n>>>3){case 1:o.elems&&o.elems.length||(o.elems=[]),o.elems.push(d.bilibili.community.service.dm.v1.DanmakuElem.decode(t,t.uint32()));break;case 2:o.state=t.int32();break;case 3:o.aiFlag=d.bilibili.community.service.dm.v1.DanmakuAIFlag.decode(t,t.uint32());break;case 5:o.colorfulSrc&&o.colorfulSrc.length||(o.colorfulSrc=[]),o.colorfulSrc.push(d.bilibili.community.service.dm.v1.DmColorful.decode(t,t.uint32()));break;default:t.skipType(7&n)}}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.DmSegMobileReply)return t;var e=new d.bilibili.community.service.dm.v1.DmSegMobileReply;if(t.elems){if(!Array.isArray(t.elems))throw TypeError(".bilibili.community.service.dm.v1.DmSegMobileReply.elems: array expected");e.elems=[];for(var i=0;i<t.elems.length;++i){if("object"!=typeof t.elems[i])throw TypeError(".bilibili.community.service.dm.v1.DmSegMobileReply.elems: object expected");e.elems[i]=d.bilibili.community.service.dm.v1.DanmakuElem.fromObject(t.elems[i])}}if(null!=t.state&&(e.state=0|t.state),null!=t.aiFlag){if("object"!=typeof t.aiFlag)throw TypeError(".bilibili.community.service.dm.v1.DmSegMobileReply.aiFlag: object expected");e.aiFlag=d.bilibili.community.service.dm.v1.DanmakuAIFlag.fromObject(t.aiFlag)}if(t.colorfulSrc){if(!Array.isArray(t.colorfulSrc))throw TypeError(".bilibili.community.service.dm.v1.DmSegMobileReply.colorfulSrc: array expected");for(e.colorfulSrc=[],i=0;i<t.colorfulSrc.length;++i){if("object"!=typeof t.colorfulSrc[i])throw TypeError(".bilibili.community.service.dm.v1.DmSegMobileReply.colorfulSrc: object expected");e.colorfulSrc[i]=d.bilibili.community.service.dm.v1.DmColorful.fromObject(t.colorfulSrc[i])}}return e},t.toObject=function(t,e){e||(e={});var i={};if((e.arrays||e.defaults)&&(i.elems=[],i.colorfulSrc=[]),e.defaults&&(i.state=0,i.aiFlag=null),t.elems&&t.elems.length){i.elems=[];for(var r=0;r<t.elems.length;++r)i.elems[r]=d.bilibili.community.service.dm.v1.DanmakuElem.toObject(t.elems[r],e)}if(null!=t.state&&t.hasOwnProperty("state")&&(i.state=t.state),null!=t.aiFlag&&t.hasOwnProperty("aiFlag")&&(i.aiFlag=d.bilibili.community.service.dm.v1.DanmakuAIFlag.toObject(t.aiFlag,e)),t.colorfulSrc&&t.colorfulSrc.length)for(i.colorfulSrc=[],r=0;r<t.colorfulSrc.length;++r)i.colorfulSrc[r]=d.bilibili.community.service.dm.v1.DmColorful.toObject(t.colorfulSrc[r],e);return i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.DmSegMobileReply"},t}(),t.DmWebViewReply=function(){function t(t){if(this.specialDms=[],this.commandDms=[],this.reportFilterContent=[],this.expressions=[],this.postPanel=[],this.activityMeta=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.state=0,t.prototype.text="",t.prototype.textSide="",t.prototype.dmSge=null,t.prototype.flag=null,t.prototype.specialDms=p.emptyArray,t.prototype.checkBox=!1,t.prototype.count=p.Long?p.Long.fromBits(0,0,!1):0,t.prototype.commandDms=p.emptyArray,t.prototype.playerConfig=null,t.prototype.reportFilterContent=p.emptyArray,t.prototype.expressions=p.emptyArray,t.prototype.postPanel=p.emptyArray,t.prototype.activityMeta=p.emptyArray,t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.DmWebViewReply;t.pos<r;){var n=t.uint32();if(n===i)break;switch(n>>>3){case 1:o.state=t.int32();break;case 2:o.text=t.string();break;case 3:o.textSide=t.string();break;case 4:o.dmSge=d.bilibili.community.service.dm.v1.DmSegConfig.decode(t,t.uint32());break;case 5:o.flag=d.bilibili.community.service.dm.v1.DanmakuFlagConfig.decode(t,t.uint32());break;case 6:o.specialDms&&o.specialDms.length||(o.specialDms=[]),o.specialDms.push(t.string());break;case 7:o.checkBox=t.bool();break;case 8:o.count=t.int64();break;case 9:o.commandDms&&o.commandDms.length||(o.commandDms=[]),o.commandDms.push(d.bilibili.community.service.dm.v1.CommandDm.decode(t,t.uint32()));break;case 10:o.playerConfig=d.bilibili.community.service.dm.v1.DanmuWebPlayerConfig.decode(t,t.uint32());break;case 11:o.reportFilterContent&&o.reportFilterContent.length||(o.reportFilterContent=[]),o.reportFilterContent.push(t.string());break;case 12:o.expressions&&o.expressions.length||(o.expressions=[]),o.expressions.push(d.bilibili.community.service.dm.v1.Expressions.decode(t,t.uint32()));break;case 13:o.postPanel&&o.postPanel.length||(o.postPanel=[]),o.postPanel.push(d.bilibili.community.service.dm.v1.PostPanel.decode(t,t.uint32()));break;case 14:o.activityMeta&&o.activityMeta.length||(o.activityMeta=[]),o.activityMeta.push(t.string());break;default:t.skipType(7&n)}}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.DmWebViewReply)return t;var e=new d.bilibili.community.service.dm.v1.DmWebViewReply;if(null!=t.state&&(e.state=0|t.state),null!=t.text&&(e.text=String(t.text)),null!=t.textSide&&(e.textSide=String(t.textSide)),null!=t.dmSge){if("object"!=typeof t.dmSge)throw TypeError(".bilibili.community.service.dm.v1.DmWebViewReply.dmSge: object expected");e.dmSge=d.bilibili.community.service.dm.v1.DmSegConfig.fromObject(t.dmSge)}if(null!=t.flag){if("object"!=typeof t.flag)throw TypeError(".bilibili.community.service.dm.v1.DmWebViewReply.flag: object expected");e.flag=d.bilibili.community.service.dm.v1.DanmakuFlagConfig.fromObject(t.flag)}if(t.specialDms){if(!Array.isArray(t.specialDms))throw TypeError(".bilibili.community.service.dm.v1.DmWebViewReply.specialDms: array expected");e.specialDms=[];for(var i=0;i<t.specialDms.length;++i)e.specialDms[i]=String(t.specialDms[i])}if(null!=t.checkBox&&(e.checkBox=Boolean(t.checkBox)),null!=t.count&&(p.Long?(e.count=p.Long.fromValue(t.count)).unsigned=!1:"string"==typeof t.count?e.count=parseInt(t.count,10):"number"==typeof t.count?e.count=t.count:"object"==typeof t.count&&(e.count=new p.LongBits(t.count.low>>>0,t.count.high>>>0).toNumber())),t.commandDms){if(!Array.isArray(t.commandDms))throw TypeError(".bilibili.community.service.dm.v1.DmWebViewReply.commandDms: array expected");for(e.commandDms=[],i=0;i<t.commandDms.length;++i){if("object"!=typeof t.commandDms[i])throw TypeError(".bilibili.community.service.dm.v1.DmWebViewReply.commandDms: object expected");e.commandDms[i]=d.bilibili.community.service.dm.v1.CommandDm.fromObject(t.commandDms[i])}}if(null!=t.playerConfig){if("object"!=typeof t.playerConfig)throw TypeError(".bilibili.community.service.dm.v1.DmWebViewReply.playerConfig: object expected");e.playerConfig=d.bilibili.community.service.dm.v1.DanmuWebPlayerConfig.fromObject(t.playerConfig)}if(t.reportFilterContent){if(!Array.isArray(t.reportFilterContent))throw TypeError(".bilibili.community.service.dm.v1.DmWebViewReply.reportFilterContent: array expected");for(e.reportFilterContent=[],i=0;i<t.reportFilterContent.length;++i)e.reportFilterContent[i]=String(t.reportFilterContent[i])}if(t.expressions){if(!Array.isArray(t.expressions))throw TypeError(".bilibili.community.service.dm.v1.DmWebViewReply.expressions: array expected");for(e.expressions=[],i=0;i<t.expressions.length;++i){if("object"!=typeof t.expressions[i])throw TypeError(".bilibili.community.service.dm.v1.DmWebViewReply.expressions: object expected");e.expressions[i]=d.bilibili.community.service.dm.v1.Expressions.fromObject(t.expressions[i])}}if(t.postPanel){if(!Array.isArray(t.postPanel))throw TypeError(".bilibili.community.service.dm.v1.DmWebViewReply.postPanel: array expected");for(e.postPanel=[],i=0;i<t.postPanel.length;++i){if("object"!=typeof t.postPanel[i])throw TypeError(".bilibili.community.service.dm.v1.DmWebViewReply.postPanel: object expected");e.postPanel[i]=d.bilibili.community.service.dm.v1.PostPanel.fromObject(t.postPanel[i])}}if(t.activityMeta){if(!Array.isArray(t.activityMeta))throw TypeError(".bilibili.community.service.dm.v1.DmWebViewReply.activityMeta: array expected");for(e.activityMeta=[],i=0;i<t.activityMeta.length;++i)e.activityMeta[i]=String(t.activityMeta[i])}return e},t.toObject=function(t,e){e||(e={});var i={};if((e.arrays||e.defaults)&&(i.specialDms=[],i.commandDms=[],i.reportFilterContent=[],i.expressions=[],i.postPanel=[],i.activityMeta=[]),e.defaults){if(i.state=0,i.text="",i.textSide="",i.dmSge=null,i.flag=null,i.checkBox=!1,p.Long){var r=new p.Long(0,0,!1);i.count=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else i.count=e.longs===String?"0":0;i.playerConfig=null}if(null!=t.state&&t.hasOwnProperty("state")&&(i.state=t.state),null!=t.text&&t.hasOwnProperty("text")&&(i.text=t.text),null!=t.textSide&&t.hasOwnProperty("textSide")&&(i.textSide=t.textSide),null!=t.dmSge&&t.hasOwnProperty("dmSge")&&(i.dmSge=d.bilibili.community.service.dm.v1.DmSegConfig.toObject(t.dmSge,e)),null!=t.flag&&t.hasOwnProperty("flag")&&(i.flag=d.bilibili.community.service.dm.v1.DanmakuFlagConfig.toObject(t.flag,e)),t.specialDms&&t.specialDms.length){i.specialDms=[];for(var o=0;o<t.specialDms.length;++o)i.specialDms[o]=t.specialDms[o]}if(null!=t.checkBox&&t.hasOwnProperty("checkBox")&&(i.checkBox=t.checkBox),null!=t.count&&t.hasOwnProperty("count")&&("number"==typeof t.count?i.count=e.longs===String?String(t.count):t.count:i.count=e.longs===String?p.Long.prototype.toString.call(t.count):e.longs===Number?new p.LongBits(t.count.low>>>0,t.count.high>>>0).toNumber():t.count),t.commandDms&&t.commandDms.length)for(i.commandDms=[],o=0;o<t.commandDms.length;++o)i.commandDms[o]=d.bilibili.community.service.dm.v1.CommandDm.toObject(t.commandDms[o],e);if(null!=t.playerConfig&&t.hasOwnProperty("playerConfig")&&(i.playerConfig=d.bilibili.community.service.dm.v1.DanmuWebPlayerConfig.toObject(t.playerConfig,e)),t.reportFilterContent&&t.reportFilterContent.length)for(i.reportFilterContent=[],o=0;o<t.reportFilterContent.length;++o)i.reportFilterContent[o]=t.reportFilterContent[o];if(t.expressions&&t.expressions.length)for(i.expressions=[],o=0;o<t.expressions.length;++o)i.expressions[o]=d.bilibili.community.service.dm.v1.Expressions.toObject(t.expressions[o],e);if(t.postPanel&&t.postPanel.length)for(i.postPanel=[],o=0;o<t.postPanel.length;++o)i.postPanel[o]=d.bilibili.community.service.dm.v1.PostPanel.toObject(t.postPanel[o],e);if(t.activityMeta&&t.activityMeta.length)for(i.activityMeta=[],o=0;o<t.activityMeta.length;++o)i.activityMeta[o]=t.activityMeta[o];return i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.DmWebViewReply"},t}(),t.DanmakuElem=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.id=p.Long?p.Long.fromBits(0,0,!1):0,t.prototype.progress=0,t.prototype.mode=0,t.prototype.fontsize=0,t.prototype.color=0,t.prototype.midHash="",t.prototype.content="",t.prototype.ctime=p.Long?p.Long.fromBits(0,0,!1):0,t.prototype.weight=0,t.prototype.action="",t.prototype.pool=0,t.prototype.idStr="",t.prototype.attr=0,t.prototype.animation="",t.prototype.colorful=0,t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.DanmakuElem;t.pos<r;){var n=t.uint32();if(n===i)break;switch(n>>>3){case 1:o.id=t.int64();break;case 2:o.progress=t.int32();break;case 3:o.mode=t.int32();break;case 4:o.fontsize=t.int32();break;case 5:o.color=t.uint32();break;case 6:o.midHash=t.string();break;case 7:o.content=t.string();break;case 8:o.ctime=t.int64();break;case 9:o.weight=t.int32();break;case 10:o.action=t.string();break;case 11:o.pool=t.int32();break;case 12:o.idStr=t.string();break;case 13:o.attr=t.int32();break;case 22:o.animation=t.string();break;case 24:o.colorful=t.int32();break;default:t.skipType(7&n)}}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.DanmakuElem)return t;var e=new d.bilibili.community.service.dm.v1.DanmakuElem;switch(null!=t.id&&(p.Long?(e.id=p.Long.fromValue(t.id)).unsigned=!1:"string"==typeof t.id?e.id=parseInt(t.id,10):"number"==typeof t.id?e.id=t.id:"object"==typeof t.id&&(e.id=new p.LongBits(t.id.low>>>0,t.id.high>>>0).toNumber())),null!=t.progress&&(e.progress=0|t.progress),null!=t.mode&&(e.mode=0|t.mode),null!=t.fontsize&&(e.fontsize=0|t.fontsize),null!=t.color&&(e.color=t.color>>>0),null!=t.midHash&&(e.midHash=String(t.midHash)),null!=t.content&&(e.content=String(t.content)),null!=t.ctime&&(p.Long?(e.ctime=p.Long.fromValue(t.ctime)).unsigned=!1:"string"==typeof t.ctime?e.ctime=parseInt(t.ctime,10):"number"==typeof t.ctime?e.ctime=t.ctime:"object"==typeof t.ctime&&(e.ctime=new p.LongBits(t.ctime.low>>>0,t.ctime.high>>>0).toNumber())),null!=t.weight&&(e.weight=0|t.weight),null!=t.action&&(e.action=String(t.action)),null!=t.pool&&(e.pool=0|t.pool),null!=t.idStr&&(e.idStr=String(t.idStr)),null!=t.attr&&(e.attr=0|t.attr),null!=t.animation&&(e.animation=String(t.animation)),t.colorful){default:if("number"==typeof t.colorful){e.colorful=t.colorful;break}break;case"NoneType":case 0:e.colorful=0;break;case"VipGradualColor":case 60001:e.colorful=60001}return e},t.toObject=function(t,e){e||(e={});var i={};if(e.defaults){if(p.Long){var r=new p.Long(0,0,!1);i.id=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else i.id=e.longs===String?"0":0;i.progress=0,i.mode=0,i.fontsize=0,i.color=0,i.midHash="",i.content="",p.Long?(r=new p.Long(0,0,!1),i.ctime=e.longs===String?r.toString():e.longs===Number?r.toNumber():r):i.ctime=e.longs===String?"0":0,i.weight=0,i.action="",i.pool=0,i.idStr="",i.attr=0,i.animation="",i.colorful=e.enums===String?"NoneType":0}return null!=t.id&&t.hasOwnProperty("id")&&("number"==typeof t.id?i.id=e.longs===String?String(t.id):t.id:i.id=e.longs===String?p.Long.prototype.toString.call(t.id):e.longs===Number?new p.LongBits(t.id.low>>>0,t.id.high>>>0).toNumber():t.id),null!=t.progress&&t.hasOwnProperty("progress")&&(i.progress=t.progress),null!=t.mode&&t.hasOwnProperty("mode")&&(i.mode=t.mode),null!=t.fontsize&&t.hasOwnProperty("fontsize")&&(i.fontsize=t.fontsize),null!=t.color&&t.hasOwnProperty("color")&&(i.color=t.color),null!=t.midHash&&t.hasOwnProperty("midHash")&&(i.midHash=t.midHash),null!=t.content&&t.hasOwnProperty("content")&&(i.content=t.content),null!=t.ctime&&t.hasOwnProperty("ctime")&&("number"==typeof t.ctime?i.ctime=e.longs===String?String(t.ctime):t.ctime:i.ctime=e.longs===String?p.Long.prototype.toString.call(t.ctime):e.longs===Number?new p.LongBits(t.ctime.low>>>0,t.ctime.high>>>0).toNumber():t.ctime),null!=t.weight&&t.hasOwnProperty("weight")&&(i.weight=t.weight),null!=t.action&&t.hasOwnProperty("action")&&(i.action=t.action),null!=t.pool&&t.hasOwnProperty("pool")&&(i.pool=t.pool),null!=t.idStr&&t.hasOwnProperty("idStr")&&(i.idStr=t.idStr),null!=t.attr&&t.hasOwnProperty("attr")&&(i.attr=t.attr),null!=t.animation&&t.hasOwnProperty("animation")&&(i.animation=t.animation),null!=t.colorful&&t.hasOwnProperty("colorful")&&(i.colorful=e.enums===String?void 0===d.bilibili.community.service.dm.v1.DmColorfulType[t.colorful]?t.colorful:d.bilibili.community.service.dm.v1.DmColorfulType[t.colorful]:t.colorful),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.DanmakuElem"},t}(),t.DanmakuAIFlag=function(){function t(t){if(this.dmFlags=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.dmFlags=p.emptyArray,t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.DanmakuAIFlag;t.pos<r;){var n=t.uint32();if(n===i)break;n>>>3==1?(o.dmFlags&&o.dmFlags.length||(o.dmFlags=[]),o.dmFlags.push(d.bilibili.community.service.dm.v1.DanmakuFlag.decode(t,t.uint32()))):t.skipType(7&n)}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.DanmakuAIFlag)return t;var e=new d.bilibili.community.service.dm.v1.DanmakuAIFlag;if(t.dmFlags){if(!Array.isArray(t.dmFlags))throw TypeError(".bilibili.community.service.dm.v1.DanmakuAIFlag.dmFlags: array expected");e.dmFlags=[];for(var i=0;i<t.dmFlags.length;++i){if("object"!=typeof t.dmFlags[i])throw TypeError(".bilibili.community.service.dm.v1.DanmakuAIFlag.dmFlags: object expected");e.dmFlags[i]=d.bilibili.community.service.dm.v1.DanmakuFlag.fromObject(t.dmFlags[i])}}return e},t.toObject=function(t,e){e||(e={});var i={};if((e.arrays||e.defaults)&&(i.dmFlags=[]),t.dmFlags&&t.dmFlags.length){i.dmFlags=[];for(var r=0;r<t.dmFlags.length;++r)i.dmFlags[r]=d.bilibili.community.service.dm.v1.DanmakuFlag.toObject(t.dmFlags[r],e)}return i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.DanmakuAIFlag"},t}(),t.DmColorful=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.type=0,t.prototype.src="",t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.DmColorful;t.pos<r;){var n=t.uint32();if(n===i)break;switch(n>>>3){case 1:o.type=t.int32();break;case 2:o.src=t.string();break;default:t.skipType(7&n)}}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.DmColorful)return t;var e=new d.bilibili.community.service.dm.v1.DmColorful;switch(t.type){default:if("number"==typeof t.type){e.type=t.type;break}break;case"NoneType":case 0:e.type=0;break;case"VipGradualColor":case 60001:e.type=60001}return null!=t.src&&(e.src=String(t.src)),e},t.toObject=function(t,e){e||(e={});var i={};return e.defaults&&(i.type=e.enums===String?"NoneType":0,i.src=""),null!=t.type&&t.hasOwnProperty("type")&&(i.type=e.enums===String?void 0===d.bilibili.community.service.dm.v1.DmColorfulType[t.type]?t.type:d.bilibili.community.service.dm.v1.DmColorfulType[t.type]:t.type),null!=t.src&&t.hasOwnProperty("src")&&(i.src=t.src),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.DmColorful"},t}(),t.DmSegConfig=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.pageSize=p.Long?p.Long.fromBits(0,0,!1):0,t.prototype.total=p.Long?p.Long.fromBits(0,0,!1):0,t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.DmSegConfig;t.pos<r;){var n=t.uint32();if(n===i)break;switch(n>>>3){case 1:o.pageSize=t.int64();break;case 2:o.total=t.int64();break;default:t.skipType(7&n)}}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.DmSegConfig)return t;var e=new d.bilibili.community.service.dm.v1.DmSegConfig;return null!=t.pageSize&&(p.Long?(e.pageSize=p.Long.fromValue(t.pageSize)).unsigned=!1:"string"==typeof t.pageSize?e.pageSize=parseInt(t.pageSize,10):"number"==typeof t.pageSize?e.pageSize=t.pageSize:"object"==typeof t.pageSize&&(e.pageSize=new p.LongBits(t.pageSize.low>>>0,t.pageSize.high>>>0).toNumber())),null!=t.total&&(p.Long?(e.total=p.Long.fromValue(t.total)).unsigned=!1:"string"==typeof t.total?e.total=parseInt(t.total,10):"number"==typeof t.total?e.total=t.total:"object"==typeof t.total&&(e.total=new p.LongBits(t.total.low>>>0,t.total.high>>>0).toNumber())),e},t.toObject=function(t,e){e||(e={});var i={};if(e.defaults){if(p.Long){var r=new p.Long(0,0,!1);i.pageSize=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else i.pageSize=e.longs===String?"0":0;p.Long?(r=new p.Long(0,0,!1),i.total=e.longs===String?r.toString():e.longs===Number?r.toNumber():r):i.total=e.longs===String?"0":0}return null!=t.pageSize&&t.hasOwnProperty("pageSize")&&("number"==typeof t.pageSize?i.pageSize=e.longs===String?String(t.pageSize):t.pageSize:i.pageSize=e.longs===String?p.Long.prototype.toString.call(t.pageSize):e.longs===Number?new p.LongBits(t.pageSize.low>>>0,t.pageSize.high>>>0).toNumber():t.pageSize),null!=t.total&&t.hasOwnProperty("total")&&("number"==typeof t.total?i.total=e.longs===String?String(t.total):t.total:i.total=e.longs===String?p.Long.prototype.toString.call(t.total):e.longs===Number?new p.LongBits(t.total.low>>>0,t.total.high>>>0).toNumber():t.total),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.DmSegConfig"},t}(),t.DanmakuFlagConfig=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.recFlag=0,t.prototype.recText="",t.prototype.recSwitch=0,t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.DanmakuFlagConfig;t.pos<r;){var n=t.uint32();if(n===i)break;switch(n>>>3){case 1:o.recFlag=t.int32();break;case 2:o.recText=t.string();break;case 3:o.recSwitch=t.int32();break;default:t.skipType(7&n)}}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.DanmakuFlagConfig)return t;var e=new d.bilibili.community.service.dm.v1.DanmakuFlagConfig;return null!=t.recFlag&&(e.recFlag=0|t.recFlag),null!=t.recText&&(e.recText=String(t.recText)),null!=t.recSwitch&&(e.recSwitch=0|t.recSwitch),e},t.toObject=function(t,e){e||(e={});var i={};return e.defaults&&(i.recFlag=0,i.recText="",i.recSwitch=0),null!=t.recFlag&&t.hasOwnProperty("recFlag")&&(i.recFlag=t.recFlag),null!=t.recText&&t.hasOwnProperty("recText")&&(i.recText=t.recText),null!=t.recSwitch&&t.hasOwnProperty("recSwitch")&&(i.recSwitch=t.recSwitch),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.DanmakuFlagConfig"},t}(),t.CommandDm=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.id=p.Long?p.Long.fromBits(0,0,!1):0,t.prototype.oid=p.Long?p.Long.fromBits(0,0,!1):0,t.prototype.mid=p.Long?p.Long.fromBits(0,0,!1):0,t.prototype.command="",t.prototype.content="",t.prototype.progress=0,t.prototype.ctime="",t.prototype.mtime="",t.prototype.extra="",t.prototype.idStr="",t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.CommandDm;t.pos<r;){var n=t.uint32();if(n===i)break;switch(n>>>3){case 1:o.id=t.int64();break;case 2:o.oid=t.int64();break;case 3:o.mid=t.int64();break;case 4:o.command=t.string();break;case 5:o.content=t.string();break;case 6:o.progress=t.int32();break;case 7:o.ctime=t.string();break;case 8:o.mtime=t.string();break;case 9:o.extra=t.string();break;case 10:o.idStr=t.string();break;default:t.skipType(7&n)}}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.CommandDm)return t;var e=new d.bilibili.community.service.dm.v1.CommandDm;return null!=t.id&&(p.Long?(e.id=p.Long.fromValue(t.id)).unsigned=!1:"string"==typeof t.id?e.id=parseInt(t.id,10):"number"==typeof t.id?e.id=t.id:"object"==typeof t.id&&(e.id=new p.LongBits(t.id.low>>>0,t.id.high>>>0).toNumber())),null!=t.oid&&(p.Long?(e.oid=p.Long.fromValue(t.oid)).unsigned=!1:"string"==typeof t.oid?e.oid=parseInt(t.oid,10):"number"==typeof t.oid?e.oid=t.oid:"object"==typeof t.oid&&(e.oid=new p.LongBits(t.oid.low>>>0,t.oid.high>>>0).toNumber())),null!=t.mid&&(p.Long?(e.mid=p.Long.fromValue(t.mid)).unsigned=!1:"string"==typeof t.mid?e.mid=parseInt(t.mid,10):"number"==typeof t.mid?e.mid=t.mid:"object"==typeof t.mid&&(e.mid=new p.LongBits(t.mid.low>>>0,t.mid.high>>>0).toNumber())),null!=t.command&&(e.command=String(t.command)),null!=t.content&&(e.content=String(t.content)),null!=t.progress&&(e.progress=0|t.progress),null!=t.ctime&&(e.ctime=String(t.ctime)),null!=t.mtime&&(e.mtime=String(t.mtime)),null!=t.extra&&(e.extra=String(t.extra)),null!=t.idStr&&(e.idStr=String(t.idStr)),e},t.toObject=function(t,e){e||(e={});var i={};if(e.defaults){if(p.Long){var r=new p.Long(0,0,!1);i.id=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else i.id=e.longs===String?"0":0;p.Long?(r=new p.Long(0,0,!1),i.oid=e.longs===String?r.toString():e.longs===Number?r.toNumber():r):i.oid=e.longs===String?"0":0,p.Long?(r=new p.Long(0,0,!1),i.mid=e.longs===String?r.toString():e.longs===Number?r.toNumber():r):i.mid=e.longs===String?"0":0,i.command="",i.content="",i.progress=0,i.ctime="",i.mtime="",i.extra="",i.idStr=""}return null!=t.id&&t.hasOwnProperty("id")&&("number"==typeof t.id?i.id=e.longs===String?String(t.id):t.id:i.id=e.longs===String?p.Long.prototype.toString.call(t.id):e.longs===Number?new p.LongBits(t.id.low>>>0,t.id.high>>>0).toNumber():t.id),null!=t.oid&&t.hasOwnProperty("oid")&&("number"==typeof t.oid?i.oid=e.longs===String?String(t.oid):t.oid:i.oid=e.longs===String?p.Long.prototype.toString.call(t.oid):e.longs===Number?new p.LongBits(t.oid.low>>>0,t.oid.high>>>0).toNumber():t.oid),null!=t.mid&&t.hasOwnProperty("mid")&&("number"==typeof t.mid?i.mid=e.longs===String?String(t.mid):t.mid:i.mid=e.longs===String?p.Long.prototype.toString.call(t.mid):e.longs===Number?new p.LongBits(t.mid.low>>>0,t.mid.high>>>0).toNumber():t.mid),null!=t.command&&t.hasOwnProperty("command")&&(i.command=t.command),null!=t.content&&t.hasOwnProperty("content")&&(i.content=t.content),null!=t.progress&&t.hasOwnProperty("progress")&&(i.progress=t.progress),null!=t.ctime&&t.hasOwnProperty("ctime")&&(i.ctime=t.ctime),null!=t.mtime&&t.hasOwnProperty("mtime")&&(i.mtime=t.mtime),null!=t.extra&&t.hasOwnProperty("extra")&&(i.extra=t.extra),null!=t.idStr&&t.hasOwnProperty("idStr")&&(i.idStr=t.idStr),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.CommandDm"},t}(),t.DanmuWebPlayerConfig=function(){function t(t){if(this.aiLevelV2Map={},t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.dmSwitch=!1,t.prototype.aiSwitch=!1,t.prototype.aiLevel=0,t.prototype.blocktop=!1,t.prototype.blockscroll=!1,t.prototype.blockbottom=!1,t.prototype.blockcolor=!1,t.prototype.blockspecial=!1,t.prototype.preventshade=!1,t.prototype.dmask=!1,t.prototype.opacity=0,t.prototype.dmarea=0,t.prototype.speedplus=0,t.prototype.fontsize=0,t.prototype.screensync=!1,t.prototype.speedsync=!1,t.prototype.fontfamily="",t.prototype.bold=!1,t.prototype.fontborder=0,t.prototype.drawType="",t.prototype.seniorModeSwitch=0,t.prototype.aiLevelV2=0,t.prototype.aiLevelV2Map=p.emptyObject,t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r,o,n=void 0===e?t.len:t.pos+e,s=new d.bilibili.community.service.dm.v1.DanmuWebPlayerConfig;t.pos<n;){var a=t.uint32();if(a===i)break;switch(a>>>3){case 1:s.dmSwitch=t.bool();break;case 2:s.aiSwitch=t.bool();break;case 3:s.aiLevel=t.int32();break;case 4:s.blocktop=t.bool();break;case 5:s.blockscroll=t.bool();break;case 6:s.blockbottom=t.bool();break;case 7:s.blockcolor=t.bool();break;case 8:s.blockspecial=t.bool();break;case 9:s.preventshade=t.bool();break;case 10:s.dmask=t.bool();break;case 11:s.opacity=t.float();break;case 12:s.dmarea=t.int32();break;case 13:s.speedplus=t.float();break;case 14:s.fontsize=t.float();break;case 15:s.screensync=t.bool();break;case 16:s.speedsync=t.bool();break;case 17:s.fontfamily=t.string();break;case 18:s.bold=t.bool();break;case 19:s.fontborder=t.int32();break;case 20:s.drawType=t.string();break;case 21:s.seniorModeSwitch=t.int32();break;case 22:s.aiLevelV2=t.int32();break;case 23:s.aiLevelV2Map===p.emptyObject&&(s.aiLevelV2Map={});var l=t.uint32()+t.pos;for(r=0,o=0;t.pos<l;){var c=t.uint32();switch(c>>>3){case 1:r=t.int32();break;case 2:o=t.int32();break;default:t.skipType(7&c)}}s.aiLevelV2Map[r]=o;break;default:t.skipType(7&a)}}return s},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.DanmuWebPlayerConfig)return t;var e=new d.bilibili.community.service.dm.v1.DanmuWebPlayerConfig;if(null!=t.dmSwitch&&(e.dmSwitch=Boolean(t.dmSwitch)),null!=t.aiSwitch&&(e.aiSwitch=Boolean(t.aiSwitch)),null!=t.aiLevel&&(e.aiLevel=0|t.aiLevel),null!=t.blocktop&&(e.blocktop=Boolean(t.blocktop)),null!=t.blockscroll&&(e.blockscroll=Boolean(t.blockscroll)),null!=t.blockbottom&&(e.blockbottom=Boolean(t.blockbottom)),null!=t.blockcolor&&(e.blockcolor=Boolean(t.blockcolor)),null!=t.blockspecial&&(e.blockspecial=Boolean(t.blockspecial)),null!=t.preventshade&&(e.preventshade=Boolean(t.preventshade)),null!=t.dmask&&(e.dmask=Boolean(t.dmask)),null!=t.opacity&&(e.opacity=Number(t.opacity)),null!=t.dmarea&&(e.dmarea=0|t.dmarea),null!=t.speedplus&&(e.speedplus=Number(t.speedplus)),null!=t.fontsize&&(e.fontsize=Number(t.fontsize)),null!=t.screensync&&(e.screensync=Boolean(t.screensync)),null!=t.speedsync&&(e.speedsync=Boolean(t.speedsync)),null!=t.fontfamily&&(e.fontfamily=String(t.fontfamily)),null!=t.bold&&(e.bold=Boolean(t.bold)),null!=t.fontborder&&(e.fontborder=0|t.fontborder),null!=t.drawType&&(e.drawType=String(t.drawType)),null!=t.seniorModeSwitch&&(e.seniorModeSwitch=0|t.seniorModeSwitch),null!=t.aiLevelV2&&(e.aiLevelV2=0|t.aiLevelV2),t.aiLevelV2Map){if("object"!=typeof t.aiLevelV2Map)throw TypeError(".bilibili.community.service.dm.v1.DanmuWebPlayerConfig.aiLevelV2Map: object expected");e.aiLevelV2Map={};for(var i=Object.keys(t.aiLevelV2Map),r=0;r<i.length;++r)e.aiLevelV2Map[i[r]]=0|t.aiLevelV2Map[i[r]]}return e},t.toObject=function(t,e){e||(e={});var i,r={};if((e.objects||e.defaults)&&(r.aiLevelV2Map={}),e.defaults&&(r.dmSwitch=!1,r.aiSwitch=!1,r.aiLevel=0,r.blocktop=!1,r.blockscroll=!1,r.blockbottom=!1,r.blockcolor=!1,r.blockspecial=!1,r.preventshade=!1,r.dmask=!1,r.opacity=0,r.dmarea=0,r.speedplus=0,r.fontsize=0,r.screensync=!1,r.speedsync=!1,r.fontfamily="",r.bold=!1,r.fontborder=0,r.drawType="",r.seniorModeSwitch=0,r.aiLevelV2=0),null!=t.dmSwitch&&t.hasOwnProperty("dmSwitch")&&(r.dmSwitch=t.dmSwitch),null!=t.aiSwitch&&t.hasOwnProperty("aiSwitch")&&(r.aiSwitch=t.aiSwitch),null!=t.aiLevel&&t.hasOwnProperty("aiLevel")&&(r.aiLevel=t.aiLevel),null!=t.blocktop&&t.hasOwnProperty("blocktop")&&(r.blocktop=t.blocktop),null!=t.blockscroll&&t.hasOwnProperty("blockscroll")&&(r.blockscroll=t.blockscroll),null!=t.blockbottom&&t.hasOwnProperty("blockbottom")&&(r.blockbottom=t.blockbottom),null!=t.blockcolor&&t.hasOwnProperty("blockcolor")&&(r.blockcolor=t.blockcolor),null!=t.blockspecial&&t.hasOwnProperty("blockspecial")&&(r.blockspecial=t.blockspecial),null!=t.preventshade&&t.hasOwnProperty("preventshade")&&(r.preventshade=t.preventshade),null!=t.dmask&&t.hasOwnProperty("dmask")&&(r.dmask=t.dmask),null!=t.opacity&&t.hasOwnProperty("opacity")&&(r.opacity=e.json&&!isFinite(t.opacity)?String(t.opacity):t.opacity),null!=t.dmarea&&t.hasOwnProperty("dmarea")&&(r.dmarea=t.dmarea),null!=t.speedplus&&t.hasOwnProperty("speedplus")&&(r.speedplus=e.json&&!isFinite(t.speedplus)?String(t.speedplus):t.speedplus),null!=t.fontsize&&t.hasOwnProperty("fontsize")&&(r.fontsize=e.json&&!isFinite(t.fontsize)?String(t.fontsize):t.fontsize),null!=t.screensync&&t.hasOwnProperty("screensync")&&(r.screensync=t.screensync),null!=t.speedsync&&t.hasOwnProperty("speedsync")&&(r.speedsync=t.speedsync),null!=t.fontfamily&&t.hasOwnProperty("fontfamily")&&(r.fontfamily=t.fontfamily),null!=t.bold&&t.hasOwnProperty("bold")&&(r.bold=t.bold),null!=t.fontborder&&t.hasOwnProperty("fontborder")&&(r.fontborder=t.fontborder),null!=t.drawType&&t.hasOwnProperty("drawType")&&(r.drawType=t.drawType),null!=t.seniorModeSwitch&&t.hasOwnProperty("seniorModeSwitch")&&(r.seniorModeSwitch=t.seniorModeSwitch),null!=t.aiLevelV2&&t.hasOwnProperty("aiLevelV2")&&(r.aiLevelV2=t.aiLevelV2),t.aiLevelV2Map&&(i=Object.keys(t.aiLevelV2Map)).length){r.aiLevelV2Map={};for(var o=0;o<i.length;++o)r.aiLevelV2Map[i[o]]=t.aiLevelV2Map[i[o]]}return r},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.DanmuWebPlayerConfig"},t}(),t.Expressions=function(){function t(t){if(this.data=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.data=p.emptyArray,t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.Expressions;t.pos<r;){var n=t.uint32();if(n===i)break;n>>>3==1?(o.data&&o.data.length||(o.data=[]),o.data.push(d.bilibili.community.service.dm.v1.Expression.decode(t,t.uint32()))):t.skipType(7&n)}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.Expressions)return t;var e=new d.bilibili.community.service.dm.v1.Expressions;if(t.data){if(!Array.isArray(t.data))throw TypeError(".bilibili.community.service.dm.v1.Expressions.data: array expected");e.data=[];for(var i=0;i<t.data.length;++i){if("object"!=typeof t.data[i])throw TypeError(".bilibili.community.service.dm.v1.Expressions.data: object expected");e.data[i]=d.bilibili.community.service.dm.v1.Expression.fromObject(t.data[i])}}return e},t.toObject=function(t,e){e||(e={});var i={};if((e.arrays||e.defaults)&&(i.data=[]),t.data&&t.data.length){i.data=[];for(var r=0;r<t.data.length;++r)i.data[r]=d.bilibili.community.service.dm.v1.Expression.toObject(t.data[r],e)}return i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.Expressions"},t}(),t.PostPanel=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.start=p.Long?p.Long.fromBits(0,0,!1):0,t.prototype.end=p.Long?p.Long.fromBits(0,0,!1):0,t.prototype.priority=p.Long?p.Long.fromBits(0,0,!1):0,t.prototype.bizId=p.Long?p.Long.fromBits(0,0,!1):0,t.prototype.bizType=0,t.prototype.clickButton=null,t.prototype.textInput=null,t.prototype.checkBox=null,t.prototype.toast=null,t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.PostPanel;t.pos<r;){var n=t.uint32();if(n===i)break;switch(n>>>3){case 1:o.start=t.int64();break;case 2:o.end=t.int64();break;case 3:o.priority=t.int64();break;case 4:o.bizId=t.int64();break;case 5:o.bizType=t.int32();break;case 6:o.clickButton=d.bilibili.community.service.dm.v1.ClickButton.decode(t,t.uint32());break;case 7:o.textInput=d.bilibili.community.service.dm.v1.TextInput.decode(t,t.uint32());break;case 8:o.checkBox=d.bilibili.community.service.dm.v1.CheckBox.decode(t,t.uint32());break;case 9:o.toast=d.bilibili.community.service.dm.v1.Toast.decode(t,t.uint32());break;default:t.skipType(7&n)}}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.PostPanel)return t;var e=new d.bilibili.community.service.dm.v1.PostPanel;switch(null!=t.start&&(p.Long?(e.start=p.Long.fromValue(t.start)).unsigned=!1:"string"==typeof t.start?e.start=parseInt(t.start,10):"number"==typeof t.start?e.start=t.start:"object"==typeof t.start&&(e.start=new p.LongBits(t.start.low>>>0,t.start.high>>>0).toNumber())),null!=t.end&&(p.Long?(e.end=p.Long.fromValue(t.end)).unsigned=!1:"string"==typeof t.end?e.end=parseInt(t.end,10):"number"==typeof t.end?e.end=t.end:"object"==typeof t.end&&(e.end=new p.LongBits(t.end.low>>>0,t.end.high>>>0).toNumber())),null!=t.priority&&(p.Long?(e.priority=p.Long.fromValue(t.priority)).unsigned=!1:"string"==typeof t.priority?e.priority=parseInt(t.priority,10):"number"==typeof t.priority?e.priority=t.priority:"object"==typeof t.priority&&(e.priority=new p.LongBits(t.priority.low>>>0,t.priority.high>>>0).toNumber())),null!=t.bizId&&(p.Long?(e.bizId=p.Long.fromValue(t.bizId)).unsigned=!1:"string"==typeof t.bizId?e.bizId=parseInt(t.bizId,10):"number"==typeof t.bizId?e.bizId=t.bizId:"object"==typeof t.bizId&&(e.bizId=new p.LongBits(t.bizId.low>>>0,t.bizId.high>>>0).toNumber())),t.bizType){default:if("number"==typeof t.bizType){e.bizType=t.bizType;break}break;case"PostPanelBizTypeNone":case 0:e.bizType=0;break;case"PostPanelBizTypeEncourage":case 1:e.bizType=1;break;case"PostPanelBizTypeColorDM":case 2:e.bizType=2;break;case"PostPanelBizTypeNFTDM":case 3:e.bizType=3;break;case"PostPanelBizTypeFragClose":case 4:e.bizType=4;break;case"PostPanelBizTypeRecommend":case 5:e.bizType=5}if(null!=t.clickButton){if("object"!=typeof t.clickButton)throw TypeError(".bilibili.community.service.dm.v1.PostPanel.clickButton: object expected");e.clickButton=d.bilibili.community.service.dm.v1.ClickButton.fromObject(t.clickButton)}if(null!=t.textInput){if("object"!=typeof t.textInput)throw TypeError(".bilibili.community.service.dm.v1.PostPanel.textInput: object expected");e.textInput=d.bilibili.community.service.dm.v1.TextInput.fromObject(t.textInput)}if(null!=t.checkBox){if("object"!=typeof t.checkBox)throw TypeError(".bilibili.community.service.dm.v1.PostPanel.checkBox: object expected");e.checkBox=d.bilibili.community.service.dm.v1.CheckBox.fromObject(t.checkBox)}if(null!=t.toast){if("object"!=typeof t.toast)throw TypeError(".bilibili.community.service.dm.v1.PostPanel.toast: object expected");e.toast=d.bilibili.community.service.dm.v1.Toast.fromObject(t.toast)}return e},t.toObject=function(t,e){e||(e={});var i={};if(e.defaults){if(p.Long){var r=new p.Long(0,0,!1);i.start=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else i.start=e.longs===String?"0":0;p.Long?(r=new p.Long(0,0,!1),i.end=e.longs===String?r.toString():e.longs===Number?r.toNumber():r):i.end=e.longs===String?"0":0,p.Long?(r=new p.Long(0,0,!1),i.priority=e.longs===String?r.toString():e.longs===Number?r.toNumber():r):i.priority=e.longs===String?"0":0,p.Long?(r=new p.Long(0,0,!1),i.bizId=e.longs===String?r.toString():e.longs===Number?r.toNumber():r):i.bizId=e.longs===String?"0":0,i.bizType=e.enums===String?"PostPanelBizTypeNone":0,i.clickButton=null,i.textInput=null,i.checkBox=null,i.toast=null}return null!=t.start&&t.hasOwnProperty("start")&&("number"==typeof t.start?i.start=e.longs===String?String(t.start):t.start:i.start=e.longs===String?p.Long.prototype.toString.call(t.start):e.longs===Number?new p.LongBits(t.start.low>>>0,t.start.high>>>0).toNumber():t.start),null!=t.end&&t.hasOwnProperty("end")&&("number"==typeof t.end?i.end=e.longs===String?String(t.end):t.end:i.end=e.longs===String?p.Long.prototype.toString.call(t.end):e.longs===Number?new p.LongBits(t.end.low>>>0,t.end.high>>>0).toNumber():t.end),null!=t.priority&&t.hasOwnProperty("priority")&&("number"==typeof t.priority?i.priority=e.longs===String?String(t.priority):t.priority:i.priority=e.longs===String?p.Long.prototype.toString.call(t.priority):e.longs===Number?new p.LongBits(t.priority.low>>>0,t.priority.high>>>0).toNumber():t.priority),null!=t.bizId&&t.hasOwnProperty("bizId")&&("number"==typeof t.bizId?i.bizId=e.longs===String?String(t.bizId):t.bizId:i.bizId=e.longs===String?p.Long.prototype.toString.call(t.bizId):e.longs===Number?new p.LongBits(t.bizId.low>>>0,t.bizId.high>>>0).toNumber():t.bizId),null!=t.bizType&&t.hasOwnProperty("bizType")&&(i.bizType=e.enums===String?void 0===d.bilibili.community.service.dm.v1.PostPanelBizType[t.bizType]?t.bizType:d.bilibili.community.service.dm.v1.PostPanelBizType[t.bizType]:t.bizType),null!=t.clickButton&&t.hasOwnProperty("clickButton")&&(i.clickButton=d.bilibili.community.service.dm.v1.ClickButton.toObject(t.clickButton,e)),null!=t.textInput&&t.hasOwnProperty("textInput")&&(i.textInput=d.bilibili.community.service.dm.v1.TextInput.toObject(t.textInput,e)),null!=t.checkBox&&t.hasOwnProperty("checkBox")&&(i.checkBox=d.bilibili.community.service.dm.v1.CheckBox.toObject(t.checkBox,e)),null!=t.toast&&t.hasOwnProperty("toast")&&(i.toast=d.bilibili.community.service.dm.v1.Toast.toObject(t.toast,e)),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.PostPanel"},t}(),t.DmColorfulType=function(){const t={},e=Object.create(t);return e[t[0]="NoneType"]=0,e[t[60001]="VipGradualColor"]=60001,e}(),t.DanmakuFlag=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.dmid=p.Long?p.Long.fromBits(0,0,!1):0,t.prototype.flag=0,t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.DanmakuFlag;t.pos<r;){var n=t.uint32();if(n===i)break;switch(n>>>3){case 1:o.dmid=t.int64();break;case 2:o.flag=t.uint32();break;default:t.skipType(7&n)}}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.DanmakuFlag)return t;var e=new d.bilibili.community.service.dm.v1.DanmakuFlag;return null!=t.dmid&&(p.Long?(e.dmid=p.Long.fromValue(t.dmid)).unsigned=!1:"string"==typeof t.dmid?e.dmid=parseInt(t.dmid,10):"number"==typeof t.dmid?e.dmid=t.dmid:"object"==typeof t.dmid&&(e.dmid=new p.LongBits(t.dmid.low>>>0,t.dmid.high>>>0).toNumber())),null!=t.flag&&(e.flag=t.flag>>>0),e},t.toObject=function(t,e){e||(e={});var i={};if(e.defaults){if(p.Long){var r=new p.Long(0,0,!1);i.dmid=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else i.dmid=e.longs===String?"0":0;i.flag=0}return null!=t.dmid&&t.hasOwnProperty("dmid")&&("number"==typeof t.dmid?i.dmid=e.longs===String?String(t.dmid):t.dmid:i.dmid=e.longs===String?p.Long.prototype.toString.call(t.dmid):e.longs===Number?new p.LongBits(t.dmid.low>>>0,t.dmid.high>>>0).toNumber():t.dmid),null!=t.flag&&t.hasOwnProperty("flag")&&(i.flag=t.flag),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.DanmakuFlag"},t}(),t.Expression=function(){function t(t){if(this.keyword=[],this.period=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.keyword=p.emptyArray,t.prototype.url="",t.prototype.period=p.emptyArray,t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.Expression;t.pos<r;){var n=t.uint32();if(n===i)break;switch(n>>>3){case 1:o.keyword&&o.keyword.length||(o.keyword=[]),o.keyword.push(t.string());break;case 2:o.url=t.string();break;case 3:o.period&&o.period.length||(o.period=[]),o.period.push(d.bilibili.community.service.dm.v1.Period.decode(t,t.uint32()));break;default:t.skipType(7&n)}}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.Expression)return t;var e=new d.bilibili.community.service.dm.v1.Expression;if(t.keyword){if(!Array.isArray(t.keyword))throw TypeError(".bilibili.community.service.dm.v1.Expression.keyword: array expected");e.keyword=[];for(var i=0;i<t.keyword.length;++i)e.keyword[i]=String(t.keyword[i])}if(null!=t.url&&(e.url=String(t.url)),t.period){if(!Array.isArray(t.period))throw TypeError(".bilibili.community.service.dm.v1.Expression.period: array expected");for(e.period=[],i=0;i<t.period.length;++i){if("object"!=typeof t.period[i])throw TypeError(".bilibili.community.service.dm.v1.Expression.period: object expected");e.period[i]=d.bilibili.community.service.dm.v1.Period.fromObject(t.period[i])}}return e},t.toObject=function(t,e){e||(e={});var i={};if((e.arrays||e.defaults)&&(i.keyword=[],i.period=[]),e.defaults&&(i.url=""),t.keyword&&t.keyword.length){i.keyword=[];for(var r=0;r<t.keyword.length;++r)i.keyword[r]=t.keyword[r]}if(null!=t.url&&t.hasOwnProperty("url")&&(i.url=t.url),t.period&&t.period.length)for(i.period=[],r=0;r<t.period.length;++r)i.period[r]=d.bilibili.community.service.dm.v1.Period.toObject(t.period[r],e);return i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.Expression"},t}(),t.PostPanelBizType=function(){const t={},e=Object.create(t);return e[t[0]="PostPanelBizTypeNone"]=0,e[t[1]="PostPanelBizTypeEncourage"]=1,e[t[2]="PostPanelBizTypeColorDM"]=2,e[t[3]="PostPanelBizTypeNFTDM"]=3,e[t[4]="PostPanelBizTypeFragClose"]=4,e[t[5]="PostPanelBizTypeRecommend"]=5,e}(),t.ClickButton=function(){function t(t){if(this.portraitText=[],this.landscapeText=[],this.portraitTextFocus=[],this.landscapeTextFocus=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.portraitText=p.emptyArray,t.prototype.landscapeText=p.emptyArray,t.prototype.portraitTextFocus=p.emptyArray,t.prototype.landscapeTextFocus=p.emptyArray,t.prototype.renderType=0,t.prototype.show=!1,t.prototype.bubble=null,t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.ClickButton;t.pos<r;){var n=t.uint32();if(n===i)break;switch(n>>>3){case 1:o.portraitText&&o.portraitText.length||(o.portraitText=[]),o.portraitText.push(t.string());break;case 2:o.landscapeText&&o.landscapeText.length||(o.landscapeText=[]),o.landscapeText.push(t.string());break;case 3:o.portraitTextFocus&&o.portraitTextFocus.length||(o.portraitTextFocus=[]),o.portraitTextFocus.push(t.string());break;case 4:o.landscapeTextFocus&&o.landscapeTextFocus.length||(o.landscapeTextFocus=[]),o.landscapeTextFocus.push(t.string());break;case 5:o.renderType=t.int32();break;case 6:o.show=t.bool();break;case 7:o.bubble=d.bilibili.community.service.dm.v1.Bubble.decode(t,t.uint32());break;default:t.skipType(7&n)}}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.ClickButton)return t;var e=new d.bilibili.community.service.dm.v1.ClickButton;if(t.portraitText){if(!Array.isArray(t.portraitText))throw TypeError(".bilibili.community.service.dm.v1.ClickButton.portraitText: array expected");e.portraitText=[];for(var i=0;i<t.portraitText.length;++i)e.portraitText[i]=String(t.portraitText[i])}if(t.landscapeText){if(!Array.isArray(t.landscapeText))throw TypeError(".bilibili.community.service.dm.v1.ClickButton.landscapeText: array expected");for(e.landscapeText=[],i=0;i<t.landscapeText.length;++i)e.landscapeText[i]=String(t.landscapeText[i])}if(t.portraitTextFocus){if(!Array.isArray(t.portraitTextFocus))throw TypeError(".bilibili.community.service.dm.v1.ClickButton.portraitTextFocus: array expected");for(e.portraitTextFocus=[],i=0;i<t.portraitTextFocus.length;++i)e.portraitTextFocus[i]=String(t.portraitTextFocus[i])}if(t.landscapeTextFocus){if(!Array.isArray(t.landscapeTextFocus))throw TypeError(".bilibili.community.service.dm.v1.ClickButton.landscapeTextFocus: array expected");for(e.landscapeTextFocus=[],i=0;i<t.landscapeTextFocus.length;++i)e.landscapeTextFocus[i]=String(t.landscapeTextFocus[i])}switch(t.renderType){default:if("number"==typeof t.renderType){e.renderType=t.renderType;break}break;case"RenderTypeNone":case 0:e.renderType=0;break;case"RenderTypeSingle":case 1:e.renderType=1;break;case"RenderTypeRotation":case 2:e.renderType=2}if(null!=t.show&&(e.show=Boolean(t.show)),null!=t.bubble){if("object"!=typeof t.bubble)throw TypeError(".bilibili.community.service.dm.v1.ClickButton.bubble: object expected");e.bubble=d.bilibili.community.service.dm.v1.Bubble.fromObject(t.bubble)}return e},t.toObject=function(t,e){e||(e={});var i={};if((e.arrays||e.defaults)&&(i.portraitText=[],i.landscapeText=[],i.portraitTextFocus=[],i.landscapeTextFocus=[]),e.defaults&&(i.renderType=e.enums===String?"RenderTypeNone":0,i.show=!1,i.bubble=null),t.portraitText&&t.portraitText.length){i.portraitText=[];for(var r=0;r<t.portraitText.length;++r)i.portraitText[r]=t.portraitText[r]}if(t.landscapeText&&t.landscapeText.length)for(i.landscapeText=[],r=0;r<t.landscapeText.length;++r)i.landscapeText[r]=t.landscapeText[r];if(t.portraitTextFocus&&t.portraitTextFocus.length)for(i.portraitTextFocus=[],r=0;r<t.portraitTextFocus.length;++r)i.portraitTextFocus[r]=t.portraitTextFocus[r];if(t.landscapeTextFocus&&t.landscapeTextFocus.length)for(i.landscapeTextFocus=[],r=0;r<t.landscapeTextFocus.length;++r)i.landscapeTextFocus[r]=t.landscapeTextFocus[r];return null!=t.renderType&&t.hasOwnProperty("renderType")&&(i.renderType=e.enums===String?void 0===d.bilibili.community.service.dm.v1.RenderType[t.renderType]?t.renderType:d.bilibili.community.service.dm.v1.RenderType[t.renderType]:t.renderType),null!=t.show&&t.hasOwnProperty("show")&&(i.show=t.show),null!=t.bubble&&t.hasOwnProperty("bubble")&&(i.bubble=d.bilibili.community.service.dm.v1.Bubble.toObject(t.bubble,e)),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.ClickButton"},t}(),t.TextInput=function(){function t(t){if(this.portraitPlaceholder=[],this.landscapePlaceholder=[],this.avatar=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.portraitPlaceholder=p.emptyArray,t.prototype.landscapePlaceholder=p.emptyArray,t.prototype.renderType=0,t.prototype.placeholderPost=!1,t.prototype.show=!1,t.prototype.avatar=p.emptyArray,t.prototype.postStatus=0,t.prototype.label=null,t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.TextInput;t.pos<r;){var n=t.uint32();if(n===i)break;switch(n>>>3){case 1:o.portraitPlaceholder&&o.portraitPlaceholder.length||(o.portraitPlaceholder=[]),o.portraitPlaceholder.push(t.string());break;case 2:o.landscapePlaceholder&&o.landscapePlaceholder.length||(o.landscapePlaceholder=[]),o.landscapePlaceholder.push(t.string());break;case 3:o.renderType=t.int32();break;case 4:o.placeholderPost=t.bool();break;case 5:o.show=t.bool();break;case 6:o.avatar&&o.avatar.length||(o.avatar=[]),o.avatar.push(d.bilibili.community.service.dm.v1.Avatar.decode(t,t.uint32()));break;case 7:o.postStatus=t.int32();break;case 8:o.label=d.bilibili.community.service.dm.v1.Label.decode(t,t.uint32());break;default:t.skipType(7&n)}}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.TextInput)return t;var e=new d.bilibili.community.service.dm.v1.TextInput;if(t.portraitPlaceholder){if(!Array.isArray(t.portraitPlaceholder))throw TypeError(".bilibili.community.service.dm.v1.TextInput.portraitPlaceholder: array expected");e.portraitPlaceholder=[];for(var i=0;i<t.portraitPlaceholder.length;++i)e.portraitPlaceholder[i]=String(t.portraitPlaceholder[i])}if(t.landscapePlaceholder){if(!Array.isArray(t.landscapePlaceholder))throw TypeError(".bilibili.community.service.dm.v1.TextInput.landscapePlaceholder: array expected");for(e.landscapePlaceholder=[],i=0;i<t.landscapePlaceholder.length;++i)e.landscapePlaceholder[i]=String(t.landscapePlaceholder[i])}switch(t.renderType){default:if("number"==typeof t.renderType){e.renderType=t.renderType;break}break;case"RenderTypeNone":case 0:e.renderType=0;break;case"RenderTypeSingle":case 1:e.renderType=1;break;case"RenderTypeRotation":case 2:e.renderType=2}if(null!=t.placeholderPost&&(e.placeholderPost=Boolean(t.placeholderPost)),null!=t.show&&(e.show=Boolean(t.show)),t.avatar){if(!Array.isArray(t.avatar))throw TypeError(".bilibili.community.service.dm.v1.TextInput.avatar: array expected");for(e.avatar=[],i=0;i<t.avatar.length;++i){if("object"!=typeof t.avatar[i])throw TypeError(".bilibili.community.service.dm.v1.TextInput.avatar: object expected");e.avatar[i]=d.bilibili.community.service.dm.v1.Avatar.fromObject(t.avatar[i])}}switch(t.postStatus){default:if("number"==typeof t.postStatus){e.postStatus=t.postStatus;break}break;case"PostStatusNormal":case 0:e.postStatus=0;break;case"PostStatusClosed":case 1:e.postStatus=1}if(null!=t.label){if("object"!=typeof t.label)throw TypeError(".bilibili.community.service.dm.v1.TextInput.label: object expected");e.label=d.bilibili.community.service.dm.v1.Label.fromObject(t.label)}return e},t.toObject=function(t,e){e||(e={});var i={};if((e.arrays||e.defaults)&&(i.portraitPlaceholder=[],i.landscapePlaceholder=[],i.avatar=[]),e.defaults&&(i.renderType=e.enums===String?"RenderTypeNone":0,i.placeholderPost=!1,i.show=!1,i.postStatus=e.enums===String?"PostStatusNormal":0,i.label=null),t.portraitPlaceholder&&t.portraitPlaceholder.length){i.portraitPlaceholder=[];for(var r=0;r<t.portraitPlaceholder.length;++r)i.portraitPlaceholder[r]=t.portraitPlaceholder[r]}if(t.landscapePlaceholder&&t.landscapePlaceholder.length)for(i.landscapePlaceholder=[],r=0;r<t.landscapePlaceholder.length;++r)i.landscapePlaceholder[r]=t.landscapePlaceholder[r];if(null!=t.renderType&&t.hasOwnProperty("renderType")&&(i.renderType=e.enums===String?void 0===d.bilibili.community.service.dm.v1.RenderType[t.renderType]?t.renderType:d.bilibili.community.service.dm.v1.RenderType[t.renderType]:t.renderType),null!=t.placeholderPost&&t.hasOwnProperty("placeholderPost")&&(i.placeholderPost=t.placeholderPost),null!=t.show&&t.hasOwnProperty("show")&&(i.show=t.show),t.avatar&&t.avatar.length)for(i.avatar=[],r=0;r<t.avatar.length;++r)i.avatar[r]=d.bilibili.community.service.dm.v1.Avatar.toObject(t.avatar[r],e);return null!=t.postStatus&&t.hasOwnProperty("postStatus")&&(i.postStatus=e.enums===String?void 0===d.bilibili.community.service.dm.v1.PostStatus[t.postStatus]?t.postStatus:d.bilibili.community.service.dm.v1.PostStatus[t.postStatus]:t.postStatus),null!=t.label&&t.hasOwnProperty("label")&&(i.label=d.bilibili.community.service.dm.v1.Label.toObject(t.label,e)),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.TextInput"},t}(),t.CheckBox=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.text="",t.prototype.type=0,t.prototype.defaultValue=!1,t.prototype.show=!1,t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.CheckBox;t.pos<r;){var n=t.uint32();if(n===i)break;switch(n>>>3){case 1:o.text=t.string();break;case 2:o.type=t.int32();break;case 3:o.defaultValue=t.bool();break;case 4:o.show=t.bool();break;default:t.skipType(7&n)}}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.CheckBox)return t;var e=new d.bilibili.community.service.dm.v1.CheckBox;switch(null!=t.text&&(e.text=String(t.text)),t.type){default:if("number"==typeof t.type){e.type=t.type;break}break;case"CheckboxTypeNone":case 0:e.type=0;break;case"CheckboxTypeEncourage":case 1:e.type=1;break;case"CheckboxTypeColorDM":case 2:e.type=2}return null!=t.defaultValue&&(e.defaultValue=Boolean(t.defaultValue)),null!=t.show&&(e.show=Boolean(t.show)),e},t.toObject=function(t,e){e||(e={});var i={};return e.defaults&&(i.text="",i.type=e.enums===String?"CheckboxTypeNone":0,i.defaultValue=!1,i.show=!1),null!=t.text&&t.hasOwnProperty("text")&&(i.text=t.text),null!=t.type&&t.hasOwnProperty("type")&&(i.type=e.enums===String?void 0===d.bilibili.community.service.dm.v1.CheckboxType[t.type]?t.type:d.bilibili.community.service.dm.v1.CheckboxType[t.type]:t.type),null!=t.defaultValue&&t.hasOwnProperty("defaultValue")&&(i.defaultValue=t.defaultValue),null!=t.show&&t.hasOwnProperty("show")&&(i.show=t.show),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.CheckBox"},t}(),t.Toast=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.text="",t.prototype.duration=0,t.prototype.show=!1,t.prototype.button=null,t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.Toast;t.pos<r;){var n=t.uint32();if(n===i)break;switch(n>>>3){case 1:o.text=t.string();break;case 2:o.duration=t.int32();break;case 3:o.show=t.bool();break;case 4:o.button=d.bilibili.community.service.dm.v1.Button.decode(t,t.uint32());break;default:t.skipType(7&n)}}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.Toast)return t;var e=new d.bilibili.community.service.dm.v1.Toast;if(null!=t.text&&(e.text=String(t.text)),null!=t.duration&&(e.duration=0|t.duration),null!=t.show&&(e.show=Boolean(t.show)),null!=t.button){if("object"!=typeof t.button)throw TypeError(".bilibili.community.service.dm.v1.Toast.button: object expected");e.button=d.bilibili.community.service.dm.v1.Button.fromObject(t.button)}return e},t.toObject=function(t,e){e||(e={});var i={};return e.defaults&&(i.text="",i.duration=0,i.show=!1,i.button=null),null!=t.text&&t.hasOwnProperty("text")&&(i.text=t.text),null!=t.duration&&t.hasOwnProperty("duration")&&(i.duration=t.duration),null!=t.show&&t.hasOwnProperty("show")&&(i.show=t.show),null!=t.button&&t.hasOwnProperty("button")&&(i.button=d.bilibili.community.service.dm.v1.Button.toObject(t.button,e)),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.Toast"},t}(),t.Period=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.start=p.Long?p.Long.fromBits(0,0,!1):0,t.prototype.end=p.Long?p.Long.fromBits(0,0,!1):0,t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.Period;t.pos<r;){var n=t.uint32();if(n===i)break;switch(n>>>3){case 1:o.start=t.int64();break;case 2:o.end=t.int64();break;default:t.skipType(7&n)}}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.Period)return t;var e=new d.bilibili.community.service.dm.v1.Period;return null!=t.start&&(p.Long?(e.start=p.Long.fromValue(t.start)).unsigned=!1:"string"==typeof t.start?e.start=parseInt(t.start,10):"number"==typeof t.start?e.start=t.start:"object"==typeof t.start&&(e.start=new p.LongBits(t.start.low>>>0,t.start.high>>>0).toNumber())),null!=t.end&&(p.Long?(e.end=p.Long.fromValue(t.end)).unsigned=!1:"string"==typeof t.end?e.end=parseInt(t.end,10):"number"==typeof t.end?e.end=t.end:"object"==typeof t.end&&(e.end=new p.LongBits(t.end.low>>>0,t.end.high>>>0).toNumber())),e},t.toObject=function(t,e){e||(e={});var i={};if(e.defaults){if(p.Long){var r=new p.Long(0,0,!1);i.start=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else i.start=e.longs===String?"0":0;p.Long?(r=new p.Long(0,0,!1),i.end=e.longs===String?r.toString():e.longs===Number?r.toNumber():r):i.end=e.longs===String?"0":0}return null!=t.start&&t.hasOwnProperty("start")&&("number"==typeof t.start?i.start=e.longs===String?String(t.start):t.start:i.start=e.longs===String?p.Long.prototype.toString.call(t.start):e.longs===Number?new p.LongBits(t.start.low>>>0,t.start.high>>>0).toNumber():t.start),null!=t.end&&t.hasOwnProperty("end")&&("number"==typeof t.end?i.end=e.longs===String?String(t.end):t.end:i.end=e.longs===String?p.Long.prototype.toString.call(t.end):e.longs===Number?new p.LongBits(t.end.low>>>0,t.end.high>>>0).toNumber():t.end),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.Period"},t}(),t.RenderType=function(){const t={},e=Object.create(t);return e[t[0]="RenderTypeNone"]=0,e[t[1]="RenderTypeSingle"]=1,e[t[2]="RenderTypeRotation"]=2,e}(),t.Bubble=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.text="",t.prototype.url="",t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.Bubble;t.pos<r;){var n=t.uint32();if(n===i)break;switch(n>>>3){case 1:o.text=t.string();break;case 2:o.url=t.string();break;default:t.skipType(7&n)}}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.Bubble)return t;var e=new d.bilibili.community.service.dm.v1.Bubble;return null!=t.text&&(e.text=String(t.text)),null!=t.url&&(e.url=String(t.url)),e},t.toObject=function(t,e){e||(e={});var i={};return e.defaults&&(i.text="",i.url=""),null!=t.text&&t.hasOwnProperty("text")&&(i.text=t.text),null!=t.url&&t.hasOwnProperty("url")&&(i.url=t.url),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.Bubble"},t}(),t.Avatar=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.id="",t.prototype.url="",t.prototype.avatarType=0,t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.Avatar;t.pos<r;){var n=t.uint32();if(n===i)break;switch(n>>>3){case 1:o.id=t.string();break;case 2:o.url=t.string();break;case 3:o.avatarType=t.int32();break;default:t.skipType(7&n)}}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.Avatar)return t;var e=new d.bilibili.community.service.dm.v1.Avatar;switch(null!=t.id&&(e.id=String(t.id)),null!=t.url&&(e.url=String(t.url)),t.avatarType){default:if("number"==typeof t.avatarType){e.avatarType=t.avatarType;break}break;case"AvatarTypeNone":case 0:e.avatarType=0;break;case"AvatarTypeNFT":case 1:e.avatarType=1}return e},t.toObject=function(t,e){e||(e={});var i={};return e.defaults&&(i.id="",i.url="",i.avatarType=e.enums===String?"AvatarTypeNone":0),null!=t.id&&t.hasOwnProperty("id")&&(i.id=t.id),null!=t.url&&t.hasOwnProperty("url")&&(i.url=t.url),null!=t.avatarType&&t.hasOwnProperty("avatarType")&&(i.avatarType=e.enums===String?void 0===d.bilibili.community.service.dm.v1.AvatarType[t.avatarType]?t.avatarType:d.bilibili.community.service.dm.v1.AvatarType[t.avatarType]:t.avatarType),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.Avatar"},t}(),t.PostStatus=function(){const t={},e=Object.create(t);return e[t[0]="PostStatusNormal"]=0,e[t[1]="PostStatusClosed"]=1,e}(),t.Label=function(){function t(t){if(this.content=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.title="",t.prototype.content=p.emptyArray,t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.Label;t.pos<r;){var n=t.uint32();if(n===i)break;switch(n>>>3){case 1:o.title=t.string();break;case 2:o.content&&o.content.length||(o.content=[]),o.content.push(t.string());break;default:t.skipType(7&n)}}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.Label)return t;var e=new d.bilibili.community.service.dm.v1.Label;if(null!=t.title&&(e.title=String(t.title)),t.content){if(!Array.isArray(t.content))throw TypeError(".bilibili.community.service.dm.v1.Label.content: array expected");e.content=[];for(var i=0;i<t.content.length;++i)e.content[i]=String(t.content[i])}return e},t.toObject=function(t,e){e||(e={});var i={};if((e.arrays||e.defaults)&&(i.content=[]),e.defaults&&(i.title=""),null!=t.title&&t.hasOwnProperty("title")&&(i.title=t.title),t.content&&t.content.length){i.content=[];for(var r=0;r<t.content.length;++r)i.content[r]=t.content[r]}return i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.Label"},t}(),t.CheckboxType=function(){const t={},e=Object.create(t);return e[t[0]="CheckboxTypeNone"]=0,e[t[1]="CheckboxTypeEncourage"]=1,e[t[2]="CheckboxTypeColorDM"]=2,e}(),t.Button=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.text="",t.prototype.action=0,t.decode=function(t,e,i){t instanceof u||(t=u.create(t));for(var r=void 0===e?t.len:t.pos+e,o=new d.bilibili.community.service.dm.v1.Button;t.pos<r;){var n=t.uint32();if(n===i)break;switch(n>>>3){case 1:o.text=t.string();break;case 2:o.action=t.int32();break;default:t.skipType(7&n)}}return o},t.fromObject=function(t){if(t instanceof d.bilibili.community.service.dm.v1.Button)return t;var e=new d.bilibili.community.service.dm.v1.Button;switch(null!=t.text&&(e.text=String(t.text)),t.action){default:if("number"==typeof t.action){e.action=t.action;break}break;case"ToastFunctionTypeNone":case 0:e.action=0;break;case"ToastFunctionTypePostPanel":case 1:e.action=1}return e},t.toObject=function(t,e){e||(e={});var i={};return e.defaults&&(i.text="",i.action=e.enums===String?"ToastFunctionTypeNone":0),null!=t.text&&t.hasOwnProperty("text")&&(i.text=t.text),null!=t.action&&t.hasOwnProperty("action")&&(i.action=e.enums===String?void 0===d.bilibili.community.service.dm.v1.ToastFunctionType[t.action]?t.action:d.bilibili.community.service.dm.v1.ToastFunctionType[t.action]:t.action),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,c.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/bilibili.community.service.dm.v1.Button"},t}(),t.AvatarType=function(){const t={},e=Object.create(t);return e[t[0]="AvatarTypeNone"]=0,e[t[1]="AvatarTypeNFT"]=1,e}(),t.ToastFunctionType=function(){const t={},e=Object.create(t);return e[t[0]="ToastFunctionTypeNone"]=0,e[t[1]="ToastFunctionTypePostPanel"]=1,e}(),t}(),t}(),t}(),t}(),t})()).community.service.dm.v1;class f{constructor(t){this.client=t}async getXml(t,e="document"){return await this.client.request({url:"https://api.bilibili.com/x/v1/dm/list.so",params:{oid:t},responseType:e,desc:`èŽ·å–å¼¹å¹• XML cid=${t}`})}async getPbWebView(t,e,i){return await this.client.request({url:"https://api.bilibili.com/x/v2/dm/web/view",params:{type:1,oid:t,pid:e,duration:i},responseType:"arraybuffer",desc:`èŽ·å–å¼¹å¹•å…ƒæ•°æ® cid=${t}`})}async getPbSeg(t,e,i){return await this.client.request({url:"https://api.bilibili.com/x/v2/dm/web/seg.so",params:{type:1,oid:t,pid:e,segment_index:i},responseType:"arraybuffer",desc:`èŽ·å–å¼¹å¹•ç‰‡æ®µ ${i} cid=${t}`})}async getHisDate(t,e){return(await this.client.request({url:"https://api.bilibili.com/x/v2/dm/history/index",params:{type:1,oid:t,month:e},responseType:"json",desc:`èŽ·å–å¼¹å¹•åŽ†å²æ—¥æœŸ month=${e} cid=${t}`})).data||[]}async getHisPb(t,e){return await this.client.request({url:"https://api.bilibili.com/x/v2/dm/web/history/seg.so",params:{type:1,oid:t,date:e},responseType:"arraybuffer",desc:`èŽ·å–å¼¹å¹•åŽ†å²ç‰‡æ®µ date=${e} cid=${t}`})}async getLikes(t,e){if(!e.length)return{};const i=e.join(",");return(await this.client.request({url:"https://api.bilibili.com/x/v2/dm/thumbup/stats",params:{oid:t,ids:i},desc:`èŽ·å–å¼¹å¹•ç‚¹èµžæ•° cid=${t} ids=${i}`})).data||{}}}class h{constructor(t,e){this.ctx=t,this.info=e||{},this.client=t.client,this.logger=t.logger||new Proxy({},{get:()=>()=>{}}),this.api=new f(this.client),this.data={},this.dmDict={},this.dmCount=0,this.errors={segments:[],dates:[]},this.dateError=[]}static parsePb(t,e){const i=m[e];if(!i)throw new Error(`æœªçŸ¥çš„ protobuf ç±»åž‹: ${e}`);const r=t instanceof Uint8Array?t:new Uint8Array(t),o=i.decode(r);return i.toObject(o,{enums:String,bytes:String})}static parseXml(t){if(!t)return[];const e=[],i=(t,i)=>{if(!t)return;const r=t.split(",");r.length<7||e.push({progress:Math.trunc(1e3*parseFloat(r[0])),mode:parseInt(r[1]),fontsize:parseInt(r[2]),color:parseInt(r[3]),ctime:parseInt(r[4]),pool:parseInt(r[5]),midHash:r[6],id:parseInt(r[7]),idStr:r[7],weight:parseInt(r[8]||"0"),content:i})};if("string"==typeof t){const e=/<d p="([^"]+)">([^<]*)<\/d>/g;let r;for(;null!==(r=e.exec(t));)i(r[1],r[2])}else{const e=t.getElementsByTagName("d");for(const t of e)i(t.getAttribute("p"),t.textContent)}return e}setData(t){this.clearData(),t.danmaku_view&&(this.data.danmaku_view=t.danmaku_view);const e=t.danmaku_list;e?.length&&e.forEach(t=>this.addDm(t)),this.buildData()}clearData(){this.dmDict={},this.buildData(),this.data.danmaku_view&&delete this.data.danmaku_view}buildData(){this.data.danmaku_list=Object.values(this.dmDict),this.dmCount=this.data.danmaku_list.length}addDm(t){const e=t.idStr??String(t.id);t.progress??=0,this.dmDict[e]?Object.assign(this.dmDict[e],t):this.dmDict[e]={...t}}async getDmXml(){const t="èŽ·å–XMLå®žæ—¶å¼¹å¹•",e=this.info.cid;if(!e)return this.logger.warn(t+"å¤±è´¥ï¼Œæœªæ‰¾åˆ°cidï¼Œè¯·æ£€æŸ¥info"),-1;this.logger.time(t+" æ€»è€—æ—¶");const i=this.dmCount,r=await this.api.getXml(e);return this.constructor.parseXml(r).forEach(t=>this.addDm(t)),this.buildData(),this.logger.timeEnd(t+" æ€»è€—æ—¶"),this.logger.log("æ–°å¢žå¼¹å¹•",this.dmCount-i),this.dmCount-i}async getDmPb(t=()=>{},e=10,i=!1){const r="èŽ·å–Protobufå®žæ—¶å¼¹å¹•",{cid:o,aid:n,duration:s}=this.info;if(!o||!n||!s)return this.logger.warn(r+"å¤±è´¥ï¼Œæœªæ‰¾åˆ°cid/aid/durationï¼Œè¯·æ£€æŸ¥info"),-1;this.logger.time(r+" æ€»è€—æ—¶");const a=this.dmCount;let l=[],c=0;if(i)l=[...this.errors.segments],c=l.length,this.errors.segments=[];else{const t=await this.api.getPbWebView(o,n,s),e=this.constructor.parsePb(t,"DmWebViewReply");e&&(this.data.danmaku_view=e);const i=e?.dmSge?.pageSize/1e3||360;c=Math.floor(s/i)+1,l=Array.from({length:c},(t,e)=>e+1)}let u=0;return await async function(t,e,i){const r=[],o=new Set;for(const n of t){const t=Promise.resolve().then(()=>i(n));r.push(t),o.add(t);const s=()=>o.delete(t);t.then(s).catch(s),o.size>=e&&await Promise.race(o)}return Promise.all(r)}(l,e,async e=>{let i=0;try{const t=await this.api.getPbSeg(o,n,e),r=this.constructor.parsePb(t,"DmSegMobileReply");r?.elems?.length&&(r.elems.forEach(t=>this.addDm(t)),i=r.elems.length)}catch(t){this.logger.error(r+`åˆ†ç‰‡ ${e} å¤±è´¥`,t),this.errors.segments.push(e)}finally{u++,t(u,c,`ç¬¬ ${e} æ®µ`,i)}}),this.buildData(),this.logger.timeEnd(r+" æ€»è€—æ—¶"),this.logger.log("æ–°å¢žå¼¹å¹•",this.dmCount-a),this.dmCount-a}async getDmPbHisByD(t,e=()=>{}){const i=t?.length||0;if(!Array.isArray(t)||0===i)return 0;const o=`èŽ·å– ${i} å¤©åŽ†å²å¼¹å¹•`,n=this.info.cid;if(!n)return this.logger.warn(o+"å¤±è´¥ï¼Œæœªæ‰¾åˆ°cidï¼Œè¯·æ£€æŸ¥info"),-1;this.logger.time(o+" æ€»è€—æ—¶");const s=this.dmCount;let a=0,l=1/0;const c=[...t].sort((t,e)=>e.localeCompare(t));for(const t of c){let o=0;const s=r(t);if(l<=s)a++,e(a,i,`${t} (è·³è¿‡)`,0);else try{const e=await this.api.getHisPb(n,t),i=this.constructor.parsePb(e,"DmSegMobileReply");i?.elems?.length?(i.elems.forEach(t=>{this.addDm(t),t.ctime<l&&(l=t.ctime)}),o=i.elems.length):l>s&&(l=s)}catch(e){this.logger.error(`èŽ·å–åŽ†å²æ—¥æœŸ ${t} å¼¹å¹•å¤±è´¥`,e),this.errors.dates.push(t)}finally{a++,e(a,i,t,o)}}return this.buildData(),this.logger.timeEnd(o+" æ€»è€—æ—¶"),this.logger.log("æ–°å¢žå¼¹å¹•",this.dmCount-s),this.dmCount-s}async getDmPbHisByM(t,e=()=>{}){const i=`èŽ·å– ${t} åŽ†å²å¼¹å¹•`,r=this.info.cid;if(!r)return this.logger.warn(i+"å¤±è´¥ï¼Œæœªæ‰¾åˆ°cidï¼Œè¯·æ£€æŸ¥info"),-1;if(!/^\d{4}-\d{2}$/.test(t))return this.logger.warn(i+'å¤±è´¥ï¼Œå‚æ•°ä¸åˆæ³•ï¼Œåº”ä¸º "YYYY-MM" æ ¼å¼'),-1;this.logger.time(i+" æ€»è€—æ—¶");const o=await this.api.getHisDate(r,t),n=await this.getDmPbHisByD(o,e);return this.logger.timeEnd(i+" æ€»è€—æ—¶"),n}async getDmPbHisRange(t={},e=()=>{}){const i="èŽ·å–èŒƒå›´åŽ†å²å¼¹å¹•",{cid:n,pubtime:s}=this.info;if(!n||!s)return this.logger.warn(i+"å¤±è´¥ï¼Œæœªæ‰¾åˆ°cidæˆ–pubtimeï¼Œè¯·æ£€æŸ¥info"),-1;const a=Math.floor(Date.now()/1e3);let l=Math.max(r(t.start)??s,s),c=Math.min(r(t.end,24)??a,a);if(c<l)return this.logger.warn(i+"é”™è¯¯ï¼Œç»“æŸæ—¶é—´æ—©äºŽèµ·å§‹æ—¶é—´"),-1;this.logger.time(i+" æ€»è€—æ—¶");const u=((t,e)=>{const i=new Date(1e3*t),r=new Date(1e3*e),o=[];let n=new Date(i.getFullYear(),i.getMonth(),1);for(;n<=r;){const t=n.getFullYear(),e=String(n.getMonth()+1).padStart(2,"0");o.push(`${t}-${e}`),n.setMonth(n.getMonth()+1)}return o})(l,c);let p=[],d=0;for(const t of u){let i=0;try{const e=await this.api.getHisDate(n,t);Array.isArray(e)&&(p.push(...e),i=e.length)}catch(e){this.logger.error(`æ‰«ææœˆä»½ ${t} å¤±è´¥`,e)}finally{d++,e(d,u.length,`æ‰«ææœˆä»½: ${t}`,i)}}const m=o(l),f=o(c);p=[...new Set(p)].filter(t=>t>=m&&t<=f);const h=await this.getDmPbHisByD(p,e);return this.logger.timeEnd(i+" æ€»è€—æ—¶"),h}async retryErrors(t=()=>{}){if(this.errors.segments.length&&await this.getDmPb(t,1,!0),this.errors.dates.length){const e=[...this.errors.dates];this.errors.dates=[],await this.getDmPbHisByD(e,t)}}}class b{constructor(t){this.client=t}async getMain(t,e,i=2,r=""){const o={type:t,oid:e,mode:i};"string"==typeof r&&(o.pagination_str=JSON.stringify({offset:r}));const n=await this.client.request({url:"https://api.bilibili.com/x/v2/reply/wbi/main",params:o,responseType:"json",sign:!0,desc:`èŽ·å–è¯„è®ºä¸»åˆ—è¡¨ oid=${e} type=${t} mode=${i} offset=${r}`});return n?.data}async getReply({type:t,oid:e,root:i,pn:r=1,ps:o=10}){const n=await this.client.request({url:"https://api.bilibili.com/x/v2/reply/reply",params:{type:t,oid:e,root:i,pn:r,ps:o},responseType:"json",desc:`èŽ·å–å­è¯„è®ºåˆ—è¡¨ oid=${e} type=${t} root=${i} pn=${r} ps=${o}`});return n?.data||{}}async getCount({type:t,oid:e}){const i=await this.client.request({url:"https://api.bilibili.com/x/v2/reply/count",params:{type:t,oid:e},responseType:"json",desc:`èŽ·å–è¯„è®ºæ€»æ•° oid=${e} type=${t}`});return i?.data}async getNote({cvid:t}){const e=await this.client.request({url:"https://api.bilibili.com/x/note/publish/info",params:{cvid:t},responseType:"json",desc:`èŽ·å–ç¬”è®° ${t}`});return e?.data}}class y{constructor(){this.clear()}clear(){this.dict={},this.nodes={},this.topSet=new Set}pickId(t,e){const i=t?.[`${e}_str`]??t?.[e];return i?String(i):"0"}validId(t){return t&&"0"!==t}setTop(t){this.topSet.clear(),(Array.isArray(t)?t:[]).forEach(t=>{const e=this.pickId(t,"rpid");this.validId(e)&&this.topSet.add(e)})}_add(t){if(!t)return;const e=this.pickId(t,"rpid");this.validId(e)&&(this.dict[e]?Object.assign(this.dict[e],t):this.dict[e]={...t})}add(t){if(this._add(t),Array.isArray(t?.replies))for(const e of t.replies)this._add(e)}_ensureNode(t,e){return this.nodes[t]||(this.nodes[t]={rpid:t,root:"0",dialog:"0",parent:"0",rcount:0,level:0,isPlaceholder:!0,isLinked:!1,childrenSet:null,dialogSet:null,subSet:null,...e}),this.nodes[t]}_linkNode(t){if(t.isLinked)return;const{rpid:e,root:i,parent:r,dialog:o}=t;if(this.validId(i)){const t=this._ensureNode(i,{level:1});t.subSet??=new Set,t.subSet.add(e),t.isPlaceholder&&this._linkNode(t)}if(this.validId(o)&&e!==o){const t=this._ensureNode(o,{root:i,dialog:o,parent:i,level:2});t.dialogSet??=new Set,t.dialogSet.add(e),t.isPlaceholder&&this._linkNode(t)}if(this.validId(r)){let n={level:t.level-1};3===t.level?n={root:i,dialog:o,parent:i,level:2}:t.level>3&&(n={root:i,dialog:o,parent:o,level:3});const s=this._ensureNode(r,n);s.childrenSet??=new Set,s.childrenSet.add(e),s.isPlaceholder&&this._linkNode(s)}t.isLinked=!0}buildNodes(){this.nodes={};for(const[t,e]of Object.entries(this.dict)){const i=this.pickId(e,"root"),r=this.pickId(e,"parent"),o=this.pickId(e,"dialog"),n=this._ensureNode(t,{root:i,dialog:o,parent:r});n.isPlaceholder=!1,n.level="0"===i?1:i===r?2:r===o?3:4,n.rcount=e.rcount??0}return Object.values(this.nodes).forEach(t=>this._linkNode(t)),this.nodes}getIncompleteRoots(){return Object.values(this.nodes).filter(t=>{if(t.isPlaceholder)return!1;if(1!==t.level)return!1;const e=t.subSet;let i=0;if(e)for(const t of e){const e=this.nodes[t];e&&!e.isPlaceholder&&i++}return t.rcount!==i}).map(t=>t.rpid)}toTree({depth:t=2,sort:e="like"}={}){this.nodes&&0!==Object.keys(this.nodes).length||this.buildNodes();const i=this.dict,r=this.nodes,o=t=>{const e=i?.[t],r=Number(e?.ctime??0);return Number.isFinite(r)?r:0},n=t=>{const e=i?.[t],r=Number(e?.like??0);return Number.isFinite(r)?r:0},s=t=>{const e=i?.[t],r=Number(e?.rcount??0);return Number.isFinite(r)?r:0},a=(t,i=!1)=>t.sort((t,r)=>{if(i){const i=this.topSet?.has(t)?0:1,o=this.topSet?.has(r)?0:1;if(i!==o)return i-o;if("like"===e){const e=n(t),i=n(r);if(e!==i)return i-e}else if("reply"===e){const e=s(t),i=s(r);if(e!==i)return i-e}}const a=o(t),l=o(r);return a!==l?a-l:String(t).localeCompare(String(r))}),l={};for(const[t]of Object.entries(r))l[t]={rpid:t,reply:i?.[t]??null},this.topSet?.has(t)&&(l[t].isTop=!0);const c=(t,e)=>t?a([...t]).map(t=>e(t)).filter(Boolean):[],u=new Map,p=e=>{const i=l[e];if(!i)return null;if(u.has(e))return u.get(e);const o=r?.[e];return u.set(e,i),1===t?1===o?.level&&(i.children=c(o?.subSet,t=>l[t])):2===t?1===o?.level?i.children=c(o?.childrenSet,t=>p(t)):2===o?.level&&(i.children=c(o?.dialogSet,t=>l[t])):i.children=c(o?.childrenSet,t=>p(t)),i.children&&i.children.length>0?i.rcount=i.children.reduce((t,e)=>e.reply?t+1+(e.rcount||0):t+(e.rcount||0),0):i.rcount=0,i},d=Object.values(r).filter(t=>t&&1===t.level&&l[t.rpid]).map(t=>t.rpid);return a(d,!0).map(p).filter(Boolean)}}class g{constructor(t,e){this.ctx=t,this.info=e||{},this.client=t.client,this.logger=t.logger||new Proxy({},{get:()=>()=>{}}),this.api=new b(this.client),this.data={},this.replyTree=new y,this.replyCount=0,this.noteDict={},this.noteSet=new Set,this.sleepTime={long:{base:2e3,jitter:2e3},short:{base:500,jitter:500}}}addList(t){if(Array.isArray(t))for(const e of t){this.replyTree.add(e);const t=this.replyTree.pickId(e,"note_cvid");t&&"0"!==t&&this.noteSet.add(t)}}setData(t){this.clearData();const e=t.top_comment_list||[];e.length&&(this.data.top_comment_list=e,this.replyTree.setTop(e),this.addList(e));const i=t.comment_list||[];this.addList(i);const r=t.note_list||[];for(const t of r)if(t.cvid){const e=String(t.cvid);this.noteDict[e]=t}this.buildData()}clearData(){this.replyTree.clear(),this.buildData(),this.data.top_comment_list&&delete this.data.top_comment_list}buildData(){this.replyTree.buildNodes(),this.data.comment_list=Object.values(this.replyTree.dict),this.replyCount=this.data.comment_list.length;const t=Object.values(this.noteDict);t.length&&(this.data.note_list=t)}async getNote(t=[]){t.forEach(t=>this.noteSet.add(String(t)));for(const t of this.noteSet){if(t in this.noteDict)continue;if("0"===t)continue;const e=await this.api.getNote({cvid:t});e&&(this.noteDict[t]=e)}this.noteSet.clear()}async getMainPage(t=2,e=""){const{type:i,oid:r}=this.info;if(!i||!r)return this.logger.warn("èŽ·å–ä¸»è¯„è®ºå¤±è´¥ï¼šæœªæ‰¾åˆ° type/oidï¼Œè¯·æ£€æŸ¥ info"),{rise:-1,nextOffset:"",pageData:null};const o=this.replyCount,n=await this.api.getMain(i,r,t,e);if(!n)throw new Error("èŽ·å–ä¸»è¯„è®ºå¤±è´¥ï¼šæ— è¿”å›žæ•°æ®");const s=n.replies||[],a=n.top_replies||[];a.length&&(this.data.top_comment_list=a,this.replyTree.setTop(a),this.addList(a)),this.addList(s),this.buildData();const l=n?.cursor?.pagination_reply?.next_offset,c=l?String(l):"";return{rise:this.replyCount-o,nextOffset:c,pageData:n}}async getMain({mode:t=2,within:e=-1,sub:i=!1,note:r=!0,onProgress:o}={}){const s="èŽ·å–è¯„è®ºä¸»åˆ—è¡¨";let a=null;if(e<0)a=null;else if(0===e){let t=0;for(const e of Object.values(this.replyTree?.dict||{}))if("0"===this.replyTree.pickId(e,"root")){const i=Number(e?.ctime??0);Number.isFinite(i)&&i>t&&(t=i)}a=t}else a=Math.floor(Date.now()/1e3)-e;this.logger.time(s+" æ€»è€—æ—¶");const l=this.replyCount;let c="",u=0;for(;;)try{const{nextOffset:e,pageData:l}=await this.getMainPage(t,c);if(u++,"function"==typeof o&&await o(this.replyCount),null!==a){const t=l?.replies||[];let e=!1;for(const i of t){const t=Number(i?.ctime??0);if(Number.isFinite(t)&&t>0&&t<a){e=!0;break}}if(e)break}if(await n({...this.sleepTime?.long,beforeFn:t=>this.logger.log(`${s} ç¬¬${u+1}é¡µï¼Œå»¶æ—¶ ${t} æ¯«ç§’`)}),r&&await this.getNote(),i&&await this.getSub(),!e)break;c=e}catch(t){this.logger.error(`${s} ç¬¬${u+1}é¡µå¤±è´¥ offset=${c}`,t);break}return this.logger.timeEnd(s+" æ€»è€—æ—¶"),this.logger.log("æ–°å¢žè¯„è®º",this.replyCount-l),this.replyCount-l}async getSub(t=null){const{type:e,oid:i}=this.info;if(!e||!i)return this.logger.warn("èŽ·å–å­è¯„è®ºåˆ—è¡¨ å¤±è´¥ï¼šæœªæ‰¾åˆ° type/oidï¼Œè¯·æ£€æŸ¥å‚æ•°"),-1;let r=[];if(r=t?Array.isArray(t)?t:[t]:this.replyTree.getIncompleteRoots(),0===r.length)return 0;const o=this.replyCount;for(let t=0;t<r.length;t++){const o=r[t],s=`èŽ·å–å­è¯„è®ºåˆ—è¡¨ root=${o}`;this.logger.time(s+" æ€»è€—æ—¶");const a=this.replyTree.dict[o];let l=1;for(;;)try{const t=await this.api.getReply({type:e,oid:i,root:o,pn:l,ps:20}),r=t?.replies||[];if(!r.length)break;this.addList(r);const c=t?.page;if(!c)break;const u=Number(c.num||l),p=Number(c.size||20),d=Number(c.count||0);if(a&&(a.rcount=d),u*p>=d)break;l=u+1,await n({...this.sleepTime.short,beforeFn:t=>this.logger.log(`${s} ç¬¬${l}é¡µï¼Œå»¶æ—¶ ${t} æ¯«ç§’`)})}catch(t){this.logger.error(`${s} é¡µç  ${l} å¤±è´¥`,t);break}this.logger.timeEnd(s+" æ€»è€—æ—¶"),t<r.length-1&&await n({...this.sleepTime.short,beforeFn:e=>this.logger.log(`${s} [${t+1}/${r.length}]ï¼Œå»¶æ—¶ ${e} æ¯«ç§’`)})}return this.buildData(),this.logger.log("æ–°å¢žè¯„è®º",this.replyCount-o),this.replyCount-o}async getReply(){await this.getMain({sub:!0}),await this.getSub(),await this.getNote()}async getCount(){const{type:t,oid:e}=this.info;if(!t||!e)throw new Error("èŽ·å–è¯„è®ºæ•°é‡å¤±è´¥ï¼šæœªæ‰¾åˆ° type/oidï¼Œè¯·æ£€æŸ¥ info");return this.api.getCount({type:t,oid:e})}}function v(t){let{name:i,httpRequest:r,handlers:o,isLog:n,loggerColor:s}=t||{};if(!r)throw new Error("httpRequest is required");i=i||"BiliDataManager",n=!1!==n,s=s||"#01a1d6";const a=new Proxy(console,{get(t,e){if(!n)return()=>{};const r=t[e];return"function"!=typeof r?r:["log","warn","error","info","debug"].includes(e)?(...e)=>r.bind(t,`%c${i}`,`background:${s};color:#fff;padding:2px 6px;border-radius:3px;font-weight:bold;`,...e)():r.bind(t)}}),c=new e(r,a),u={client:c,logger:a};return{name:i,client:c,logger:a,BiliArchive:class extends l{constructor(){super(u,o)}},BiliDanmaku:class extends h{constructor(t){super(u,t)}},BiliComment:class extends g{constructor(t){super(u,t)}}}}})(),__webpack_exports__})());